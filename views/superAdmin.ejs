<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Super Admin Dashboard | Rixi Lab</title>

  <!-- Bootstrap 5 CSS -->
  <link rel="stylesheet" href="/bootstrap/css/bootstrap.min.css">
  
  <!-- Icons -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">

  <link rel="stylesheet" href="/css/admin.css">
  <link rel="stylesheet" href="/css/superAdmin.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">

  <!-- Favicons -->
  <link href="/img/Rixi Lab New Logo PNG.png" rel="icon">
  <link href="/img/apple-touch-icon.png" rel="apple-touch-icon">  
  
  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
</head>
<body>
    <%
       // --- Calculate Growth Data (Per Batch) ---
       let growthLabels = [];
       let growthData   = [];

       if (typeof interns !== 'undefined' && interns && interns.length > 0) {
          const batchMap = {};
          interns.forEach(intern => {
             const b = intern.batch_no != null ? String(intern.batch_no) : 'Unknown';
             batchMap[b] = (batchMap[b] || 0) + 1;
          });

          const sortedBatches = Object.keys(batchMap).sort((a, b) => {
             const numA = parseFloat(a), numB = parseFloat(b);
             return isNaN(numA) || isNaN(numB) ? a.localeCompare(b) : numA - numB;
          });

          sortedBatches.forEach(b => {
             growthLabels.push(b);
             growthData.push(batchMap[b]);
          });
       }

       // --- Calculate Insight Stats ---
       const totalInterns  = (typeof interns !== 'undefined' && interns) ? interns.length : 0;
       const certCount     = totalInterns > 0 ? interns.filter(i => i.isPassed).length : 0;
       const certPct       = totalInterns > 0 ? Math.round((certCount / totalInterns) * 100) : 0;

       // Domain distribution â€” find top domain
       const domainMap = {};
       let statsOnTime = 0, statsLate = 0, statsPending = 0;
       if (totalInterns > 0) {
          interns.forEach(intern => {
             const d = intern.domain || 'Other';
             domainMap[d] = (domainMap[d] || 0) + 1;
             if (intern.projectAssigned && Array.isArray(intern.projectAssigned)) {
                intern.projectAssigned.forEach(p => {
                   const st = p.status ? p.status.toLowerCase() : 'pending';
                   if (st === 'accepted') statsOnTime++;
                   else if (st === 'rejected') statsLate++;
                   else statsPending++;
                });
             }
          });
       }
       const topDomain = Object.keys(domainMap).sort((a,b) => domainMap[b] - domainMap[a])[0] || 'N/A';
       const topDomainCount = domainMap[topDomain] || 0;

       const quizTakers = totalInterns > 0 ? interns.filter(i => i.quiz_score && i.quiz_score > 0).length : 0;
       const quizPassPct = quizTakers > 0 ? Math.round((interns.filter(i => i.isPassed).length / quizTakers) * 100) : 0;
       const totalSubmissions = statsOnTime + statsLate + statsPending;

       // --- Top 5 Ambassadors ---
       let ambassadorMap = {};
       if (typeof ambassadors !== 'undefined' && ambassadors) {
           ambassadors.forEach(a => {
               ambassadorMap[a.name] = a.referredInterns ? a.referredInterns.length : 0;
           });
       }
       const top5Ambassadors = Object.entries(ambassadorMap)
           .sort((a, b) => b[1] - a[1])
           .slice(0, 5);
       
       const topAmbassadorLabels = top5Ambassadors.map(a => a[0]);
       const topAmbassadorData = top5Ambassadors.map(a => a[1]);

       // --- Domains Chart Data ---
       const domainLabels = Object.keys(domainMap);
       const domainData = Object.values(domainMap);

    %>

  <div class="sidebar-overlay" id="sidebarOverlay"></div>

  <!-- Sidebar -->
  <aside class="sidebar" id="sidebar">
    <div class="sidebar-brand">
      <img src="/img/Rixi Lab New Logo PNG.png" alt="Rixi Lab Logo">
      <div class="sidebar-brand-text">
        <h2>Rixi Lab</h2>
        <span class="sidebar-badge" style="border-color: #ff6600;">SUPER ADMIN</span>
      </div>
    </div>

    <nav class="sidebar-nav">
      <div class="sidebar-nav-label">Main Menu</div>
      <a href="#dashboard" class="nav-link active" onclick="setActive(this)">
        <i class="bi bi-grid-1x2-fill"></i> 
        <span>Dashboard</span>
      </a>
      
      <div class="sidebar-nav-label">Team Management</div>
      <a href="#viewAdmin" class="nav-link" onclick="setActive(this)">
        <i class="bi bi-person-workspace"></i> 
        <span>View Admins</span>
      </a>
      <a href="#createAdmin" class="nav-link" onclick="setActive(this)">
        <i class="bi bi-person-plus"></i> 
        <span>Create Admin</span>
      </a>
      
      <div class="sidebar-nav-label">Intern Management</div>
      <a href="#viewInterns" class="nav-link" onclick="setActive(this)">
        <i class="bi bi-people-fill"></i> 
        <span>View Interns</span>
      </a>
      <a href="#completedInterns" class="nav-link" onclick="setActive(this)">
        <i class="bi bi-award-fill"></i> 
        <span>Certified Interns</span>
      </a>
      
      <div class="sidebar-nav-label">Ambassador Program</div>
      <a href="#viewAmbassador" class="nav-link" onclick="setActive(this)">
        <i class="bi bi-person-badge"></i> 
        <span>View Ambassadors</span>
      </a>
      <a href="#createAmbassador" class="nav-link" onclick="setActive(this)">
        <i class="bi bi-person-plus-fill"></i> 
        <span>Create Ambassador</span>
      </a>

      <div class="sidebar-nav-label">Communications</div>
      <a href="#scheduleMeetingSection" class="nav-link" onclick="setActive(this)">
        <i class="bi bi-calendar-plus-fill"></i> 
        <span>Schedule Meeting</span>
      </a>
      <a href="#manageMeetingsSection" class="nav-link" onclick="setActive(this)">
        <i class="bi bi-calendar2-range-fill"></i> 
        <span>Manage Meetings</span>
      </a>

      <!-- Mobile Only Mail Links -->
      <div class="sidebar-nav-label d-md-none">Mails</div>
      <a href="#offerLetterMail" class="nav-link d-md-none" onclick="setActive(this)">
        <i class="bi bi-envelope-paper-fill"></i> 
        <span>Offer Letter Mail</span>
      </a>
      <a href="#completionMail" class="nav-link d-md-none" onclick="setActive(this)">
        <i class="bi bi-envelope-check-fill"></i> 
        <span>Completion Mail</span>
      </a>

      <div class="sidebar-nav-label">Account</div>
      <a href="#" data-bs-toggle="modal" data-bs-target="#logoutModal">
        <i class="bi bi-box-arrow-right"></i> 
        <span>Logout</span>
      </a>
    </nav>

    <div class="sidebar-footer">
      Â© 2025 Rixi Lab<br>
    </div>
  </aside>

  <!-- Main Content Wrapper -->
  <div class="main-content">
    
    <!-- Topbar -->
    <header class="admin-topbar">
      <div class="d-flex align-items-center">
        <button class="sidebar-toggle-btn" id="sidebarToggle">
          <i class="bi bi-list"></i>
        </button>
        <div class="topbar-left ms-2">
          <h4>Welcome, <%= superAdmin.name.split(' ')[0] %></h4>
          <p class="d-none d-sm-block"><%= superAdmin.designation %></p>
        </div>
      </div>

      <div class="topbar-right">
        <!-- Registration Button -->
        <button class="topbar-btn" onclick="showSection('registration')" title="View Registrations">
          <i class="bi bi-clipboard-data"></i>
          <% const regCount = registrations ? registrations.length : 0; %>
          <% if (regCount > 0) { %>
            <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger" style="font-size: 0.6rem;">
              <%= regCount %>
            </span>
          <% } %>
        </button>

        <!-- Offer Letter Bell -->
        <button class="topbar-btn d-none d-md-flex" id="offerLetterButton" onclick="showSection('offerLetterMail')" title="Offer Letter">
          <i class="bi bi-envelope-paper"></i>
          <% const pendingOfferCount = interns && Array.isArray(interns) ? interns.filter(i => !i.offer_letter_sent).length : 0; %>
          <% if (pendingOfferCount > 0) { %>
            <span class="position-absolute top-0 start-100 translate-middle p-1 bg-warning border border-light rounded-circle"></span>
          <% } %>
        </button>

        <!-- Completion Mail Bell -->
        <button class="topbar-btn d-none d-md-flex" id="completionMailButton" onclick="showSection('completionMail')" title="Completion Mail">
          <i class="bi bi-envelope-check"></i>
          <% const pendingCompletionCount = interns && Array.isArray(interns) ? interns.filter(i => i.isPassed && !i.completionSent).length : 0; %>
          <% if (pendingCompletionCount > 0) { %>
            <span class="position-absolute top-0 start-100 translate-middle p-1 bg-primary border border-light rounded-circle"></span>
          <% } %>
        </button>

        <!-- Notification Bell -->
        <div class="dropdown">
          <button class="topbar-btn" data-bs-toggle="dropdown" aria-expanded="false">
            <i class="bi bi-bell"></i>
            <% const unreadCount = notifications ? notifications.length : 0; %>
            <% if (unreadCount > 0) { %>
              <span class="position-absolute top-0 start-100 translate-middle p-1 bg-success border border-light rounded-circle"></span>
            <% } %>
          </button>
          
          <ul class="dropdown-menu dropdown-menu-end notif-dropdown shadow-lg" style="width: 320px;" id="notificationList">
            <li class="notif-header">
              <span>Notifications (<%= unreadCount %>)</span>
              <% if (notifications && notifications.length > 0) { %>
                <button id="clearAllBtn" class="btn btn-xs btn-outline-light py-0" style="font-size: 0.7rem;">Clear All</button>
              <% } %>
            </li>
            <div style="max-height: 300px; overflow-y: auto;">
              <% if (notifications && notifications.length > 0) { %>
                <% notifications.forEach(n => { %>
                  <li class="notif-item" data-id="<%= n._id %>">
                    <div>
                      <strong><%= n.title %></strong>
                      <small class="text-muted d-block"><%= n.message %></small>
                      <small class="text-primary" style="font-size: 0.65rem;"><%= new Date(n.createdAt).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'}) %></small>
                    </div>
                    <button class="btn btn-sm btn-outline-success mark-read-btn py-0 px-1" title="Mark as Read"><i class="bi bi-check2"></i></button>
                  </li>
                <% }) %>
              <% } else { %>
                <li class="p-4 text-center text-muted small">No new notifications ðŸŽ‰</li>
              <% } %>
            </div>
          </ul>
        </div>

        <!-- User Profile Dropdown -->
        <div class="dropdown ms-2">
          <a href="#" class="d-flex align-items-center text-decoration-none dropdown-toggle" data-bs-toggle="dropdown">
            <img src="<%= superAdmin.img_url %>" alt="Profile" class="rounded-circle border border-2 border-white shadow-sm" width="40" height="40" style="object-fit: cover;">
          </a>
          <ul class="dropdown-menu dropdown-menu-end shadow-lg border-0">
            <li><h6 class="dropdown-header">Signed in as <br><strong><%= superAdmin.email %></strong></h6></li>
            <li><hr class="dropdown-divider"></li>
            <li><a class="dropdown-item" href="#" data-bs-toggle="modal" data-bs-target="#updateProfileModal"><i class="bi bi-person me-2"></i> Update Photo</a></li>
            <li><hr class="dropdown-divider"></li>
            <li><a class="dropdown-item text-danger" href="#" data-bs-toggle="modal" data-bs-target="#logoutModal"><i class="bi bi-box-arrow-right me-2"></i> Logout</a></li>
          </ul>
        </div>

      </div>
    </header>

    <!-- Content Body -->
    <div class="content-body">
      
      <%- include("partials/toaster") %>
      <%- include('partials/loader') %>

      <!-- DASHBOARD SECTION -->
      <section id="dashboard" class="content-section">
        
        <div class="page-header">
          <h4>Dashboard Overview</h4>
          <p>Real-time insights and performance metrics across all domains.</p>
        </div>

        <!-- 1. Stats Row -->
        <div class="row g-4 mb-4">
          <div class="col-12 col-sm-6 col-xl-3">
            <div class="stat-card stat-card-1">
              <i class="bi bi-person-badge-fill stat-icon"></i>
              <div class="stat-label">Total Admins</div>
              <div class="stat-value"><%= admins ? admins.length : 0 %></div>
              <div class="stat-sub">Active staff members</div>
            </div>
          </div>
          <div class="col-12 col-sm-6 col-xl-3">
            <div class="stat-card stat-card-2">
              <i class="bi bi-people-fill stat-icon"></i>
              <div class="stat-label">Total Interns</div>
              <div class="stat-value"><%= interns ? interns.length : 0 %></div>
              <div class="stat-sub">Across all batches</div>
            </div>
          </div>
          <div class="col-12 col-sm-6 col-xl-3">
            <div class="stat-card stat-card-3">
              <i class="bi bi-layers-fill stat-icon"></i>
              <div class="stat-label">Total Batches</div>
              <div class="stat-value"><%= batches ? batches.length : 0 %></div>
              <div class="stat-sub">Current running cohorts</div>
            </div>
          </div>
          <div class="col-12 col-sm-6 col-xl-3">
            <div class="stat-card stat-card-4">
              <i class="bi bi-award-fill stat-icon"></i>
              <div class="stat-label">Certified</div>
              <div class="stat-value"><%= certifiedInternsCount %></div>
              <div class="stat-sub">Program completions</div>
            </div>
          </div>
        </div>

        <!-- 2. Charts & Insights Row -->
        <div class="row g-4 mb-4">
          <!-- Main Chart: Intern Growth -->
          <div class="col-lg-8 mb-4">
            <div class="chart-card h-100">
              <div class="chart-card-header">
                <h5><i class="bi bi-graph-up-arrow"></i> Intern Growth Analytics</h5>
                <span class="chart-card-badge">All Batches</span>
              </div>
              <div class="chart-container" style="height: 300px; padding-bottom: 20px;">
                <canvas id="internGrowthChart"></canvas>
              </div>
            </div>
          </div>

          <!-- Donut Charts Row -->
          <div class="col-lg-4">
             <div class="chart-card h-100">
               <div class="chart-card-header">
                 <h5><i class="bi bi-pie-chart-fill"></i> Domain Distribution</h5>
               </div>
               <div class="chart-container" style="height: 250px; display: flex; justify-content: center; align-items: center;">
                 <canvas id="domainDonutChart"></canvas>
               </div>
             </div>
          </div>
          
          <div class="col-lg-4">
             <div class="chart-card h-100">
               <div class="chart-card-header">
                 <h5><i class="bi bi-award-fill"></i> Certified Interns</h5>
               </div>
               <div class="chart-container" style="height: 250px; display: flex; justify-content: center; align-items: center;">
                 <canvas id="certifiedDonutChart"></canvas>
               </div>
             </div>
          </div>

          <div class="col-lg-4">
             <div class="chart-card h-100">
               <div class="chart-card-header">
                 <h5><i class="bi bi-star-fill"></i> Top 5 Ambassadors</h5>
               </div>
               <div class="chart-container" style="height: 250px; display: flex; justify-content: center; align-items: center;">
                 <canvas id="ambassadorDonutChart"></canvas>
               </div>
             </div>
          </div>


          <div class="col-lg-4">
            <div class="chart-card h-100 d-flex flex-column">
              <div class="chart-card-header">
                <h5><i class="bi bi-lightbulb-fill"></i> Key Insights</h5>
              </div>
              <div class=" d-flex flex-column gap-3 flex-grow-1 justify-content-between">

                <!-- Certification Rate -->
                <div class="insight-row">
                  <div class="insight-label"><i class="bi bi-award-fill text-warning me-1"></i>Certification Rate</div>
                  <div class="insight-bar-wrap">
                    <div class="insight-bar" style="width: <%= certPct %>%"></div>
                  </div>
                  <div class="insight-value"><%= certPct %>%</div>
                </div>

                <!-- Project Submissions -->
                <div class="insight-row">
                  <div class="insight-label"><i class="bi bi-check2-square text-success me-1"></i>Projects Accepted</div>
                  <div class="insight-bar-wrap">
                    <div class="insight-bar insight-bar-green" style="width: <%= totalSubmissions > 0 ? Math.round((statsOnTime/totalSubmissions)*100) : 0 %>%"></div>
                  </div>
                  <div class="insight-value"><%= statsOnTime %></div>
                </div>

                <!-- Projects Pending -->
                <div class="insight-row">
                  <div class="insight-label"><i class="bi bi-hourglass-split text-warning me-1"></i>Pending Review</div>
                  <div class="insight-bar-wrap">
                    <div class="insight-bar insight-bar-yellow" style="width: <%= totalSubmissions > 0 ? Math.round((statsPending/totalSubmissions)*100) : 0 %>%"></div>
                  </div>
                  <div class="insight-value"><%= statsPending %></div>
                </div>

                <!-- Top Domain -->
                <div class="insight-stat-row">
                  <div>
                    <div class="insight-stat-label">Top Domain</div>
                    <div class="insight-stat-val"><%= topDomain %></div>
                  </div>
                  <div class="insight-stat-badge"><%= topDomainCount %> interns</div>
                </div>

                <!-- Quiz Pass Rate -->
                <div class="insight-stat-row">
                  <div>
                    <div class="insight-stat-label">Quiz Pass Rate</div>
                    <div class="insight-stat-val"><%= quizPassPct %>%</div>
                  </div>
                  <div class="insight-stat-badge"><%= interns && Array.isArray(interns) ? interns.filter(i=>i.isPassed).length : 0 %> / <%= quizTakers %> takers</div>
                </div>

              </div>
            </div>
          </div>
        </div>

        <!-- 3. Lower Section: Profile, Meetings & Notices -->
        <div class="row g-4">
          
          <!-- Column 1: Profile -->
          <div class="col-12 col-lg-4">
            <div class="profile-card-new text-center h-100">
              <div class="profile-avatar-wrap">
                <img src="<%= superAdmin.img_url %>" alt="Super Admin" data-bs-toggle="modal" data-bs-target="#updateProfileModal">
              </div>
              <div class="profile-info">
                <h4><%= superAdmin.name %></h4>
                <span class="badge"><%= superAdmin.designation %></span>
              </div>
              
              <div class="profile-meta mt-4">
                <div class="profile-meta-item">
                  <div class="pm-label">Phone</div>
                  <div class="pm-value"><%= superAdmin.phone %></div>
                </div>
                <div class="profile-meta-item">
                  <div class="pm-label">Email</div>
                  <div class="pm-value" style="font-size:0.75rem;"><%= superAdmin.email %></div>
                </div>
              </div>
              <div class="mt-4 text-start small text-muted px-2" style="font-size: 0.8rem; line-height: 1.5;">
                Iâ€™m Rajnish Sharma, founder of Rixi Lab, driven by passion for technology and design. Rixi Lab reflects my vision to create innovative, user-friendly, and impactful digital solutions. We aim to empower businesses with custom websites, responsive designs, UI/UX, and e-commerce platforms, turning ideas into meaningful online experiences.
              </div>
            </div>
          </div>

          <!-- Column 2: Notices -->
          <div class="col-12 col-lg-8">
            <div class="notice-card h-100">
              <div class="notice-card-header py-3 d-flex justify-content-between align-items-center">
                <div><i class="bi bi-megaphone-fill"></i> Manage Notices</div>
                <button type="submit" class="btn btn-outline-primary btn-sm px-3 rounded-pill" form="noticeForm">Circulate</button>
              </div>
              
              <div class="p-3 border-bottom">
                <form action="/superAdmin/notice" method="POST" id="noticeForm" class="row g-2">
                  <div class="col-12">
                     <input type="text" name="title" class="form-control" placeholder="Notice Title" required>
                  </div>
                  <div class="col-12">
                     <textarea name="description" class="form-control" placeholder="Notice Description" rows="2" required></textarea>
                  </div>
                </form>
              </div>

              <div class="notice-card-body p-3 fixed-height-body" style="height: 200px; max-height: 200px;">
                <% if (superAdmin.notice && superAdmin.notice.length > 0) { %>
                  <% superAdmin.notice.slice().reverse().forEach((n, i) => { %>
                    <div class="notice-item <%= i === 0 ? 'latest' : '' %>" onclick="this.classList.toggle('expanded')" style="cursor: pointer;">
                      <div class="d-flex justify-content-between align-items-start mb-1">
                         <strong style="white-space: normal; flex: 1;"><%= n.title %></strong>
                         
                         <form action="/superAdmin/notice/delete/<%= superAdmin.notice.length - 1 - i %>" method="POST" style="display:inline; margin-left:10px;">
                           <button type="submit" class="btn btn-outline-danger btn-sm p-1 d-flex align-items-center justify-content-center" style="width: 24px; height: 24px; border-radius: 50%;" onclick="event.stopPropagation();">
                             <i class="bi bi-trash fs-6"></i>
                           </button>
                         </form>
                         
                         <i class="bi bi-chevron-down notice-chevron ms-2" style="font-size: 0.7rem; flex-shrink: 0; transition: transform 0.25s ease;"></i>
                      </div>
                      <small class="notice-text"><%= n.description %></small>
                    </div>
                  <% }) %>
                <% } else { %>
                  <div class="text-center py-4 text-muted small">
                     <i class="bi bi-inbox display-6 d-block mb-2 opacity-25"></i>
                     No notices available
                  </div>
                <% } %>
              </div>
            </div>
          </div>

        </div> <!-- end row 3 -->
      </section>
      
  <!-- Create Admin -->
<section id="createAdmin" style="display:none;">
  <div class="card p-4 shadow-sm mb-4" style="border-color: #ff6600 !important;">
    <h4 class="text-center mb-4">Create Employee / Admin</h4>
    <form action="/create-admin" method="POST" class="row g-3 needs-validation" novalidate enctype="multipart/form-data">
      
      <!-- Row 1 -->
      <div class="col-md-6">
        <input type="text" name="name" class="form-control" placeholder="Full Name" required>
      </div>
      <div class="col-md-6">
        <input type="email" name="email" class="form-control" placeholder="Email" required>
      </div>

      <!-- Row 2 -->
      <div class="col-md-6">
        <input type="text" name="password" class="form-control" placeholder="Password" required>
      </div>
      <div class="col-md-6">
        <select name="domain" class="form-select" required>
          <option value="" disabled selected>Domain</option>
          <option value="Web Development">Web Development</option>
          <option value="Graphics Designing">Graphics Designing</option>
          <option value="Data Analytics">Data Analytics</option>
          <option value="DSA">DSA</option>
          <option value="Java Programming">Java Programming</option>
          <option value="Python Programming">Python Programming</option>
          <option value="Full Stack Development">Full Stack Development</option>
        </select>
      </div>

      <!-- Row 3 -->
      <div class="col-md-6">
        <input type="text" name="emp_id" class="form-control" placeholder="Employee ID" required>
      </div>
      <div class="col-md-6">
        <input type="text" name="phone" class="form-control" placeholder="Phone" required>
      </div>

      <!-- Row 4 -->
      <div class="col-md-6">
        <input type="text" name="designation" class="form-control" placeholder="Designation" required>
      </div>
      <div class="col-md-6">
       <input type="file" name="image" id="img" class="form-control" accept="image/*">
      </div>

      <!-- Button Centered -->
      <div class="col-12 text-center mt-3">
        <button class="btn btn-primary px-5">Create Admin</button>
      </div>

    </form>
  </div>
</section>

<!-- Create Ambassador -->
<section id="createAmbassador" style="display:none;">
  <div class="card p-4 shadow-sm mb-4" style="border-color: #ff6600 !important;">
    <h4 class="text-center mb-4">Create Ambassador</h4>
    <form action="/create-ambassador" method="POST" class="row g-3 needs-validation" novalidate enctype="multipart/form-data">

      <!-- Row 1 -->
      <div class="col-md-6">
        <input type="text" name="ambassador_id" class="form-control" placeholder="Ambassador ID" required>
      </div>
      <div class="col-md-6">
        <input type="text" name="name" class="form-control" placeholder="Full Name" required>
      </div>

      <!-- Row 2 -->
      <div class="col-md-6">
        <input type="email" name="email" class="form-control" placeholder="Email" required>
      </div>
      <div class="col-md-6">
        <input type="text" name="password" class="form-control" placeholder="Password" required>
      </div>

      <!-- Row 3 -->
      <div class="col-md-6">
        <input type="text" name="phone" class="form-control" placeholder="Phone" required>
      </div>
      <div class="col-md-6">
        <input type="text" name="college" class="form-control" placeholder="College" required>
      </div>

      <!-- Row 4 -->
      <div class="col-md-6">
        <input type="text" name="university" class="form-control" placeholder="University" required>
      </div>
      <div class="col-md-6">
        <input type="text" name="designation" class="form-control" placeholder="Designation" required>
      </div>

      <!-- Row 5 -->
      <div class="col-md-6">
         <input type="file" name="image" class="form-control" accept="image/*">
      </div>
      <div class="col-md-6">
        <input type="text" name="address[street]" class="form-control" placeholder="Street" required>
      </div>

      <!-- Row 6 -->
      <div class="col-md-6">
        <input type="text" name="address[city]" class="form-control" placeholder="City" required>
      </div>
      <div class="col-md-6">
        <input type="text" name="address[state]" class="form-control" placeholder="State" required>
      </div>

      <!-- Row 7 -->
      <div class="col-md-6">
        <input type="text" name="address[country]" class="form-control" placeholder="Country" required>
      </div>
      <div class="col-md-6">
        <input type="text" name="address[pincode]" class="form-control" placeholder="Pincode" required>
      </div>

      <!-- Row 8 -->
      <div class="col-md-6">
        <select name="gender" class="form-select" required>
          <option value="" disabled selected>Gender</option>
          <option value="Male">Male</option>
          <option value="Female">Female</option>
          <option value="Other">Other</option>
        </select>
      </div>
      <div class="col-md-6">
        <input type="url" name="linkedin_profile_url" class="form-control" placeholder="LinkedIn URL" required>
      </div>

      <!-- Row 9: Social Profiles -->
      <div class="col-md-6">
        <input type="url" name="insta_profile_url" class="form-control" placeholder="Instagram URL" required>
      </div>
      <div class="col-md-6">
        <input type="text" name="referralId" class="form-control" placeholder="Reffral ID" required>
      </div> <!-- Empty div to keep layout -->

      <!-- Row 10: Submit Button (centered) -->
      <div class="col-12 text-center mt-3">
        <button class="btn btn-primary px-5">Create Ambassador</button>
      </div>

    </form>
  </div>
</section>

<!-- View Ambassador -->
<section id="viewAmbassador" style="display:none;">
  <div class="d-flex justify-content-between align-items-center mb-4 flex-wrap gap-2 ">
  <h4 class="section-title mb-0">List of Ambassadors</h4>
  <div class="d-flex align-items-center" style="gap: 10px;">
    <input 
      type="text" 
      id="ambassadorSearch" 
      class="form-control shadow-sm" 
      placeholder="Search by Name or Ambassador ID..." 
      style="max-width: 300px; border-radius: 25px; padding: 8px 15px;"
    >
    <button 
      id="clearFilter" 
      class="btn btn-outline-secondary shadow-sm rounded-pill px-3"
      style="white-space: nowrap;"
    >
      Clear
    </button>
  </div>
</div>

  <div class="row row-cols-1 row-cols-md-3 g-4">
    <% ambassadors.forEach(ambassador => { %>
      <div class="col ambassador-card">
        <div class="admin-card-modern">
          
          <!-- Header: Background Gradient + Avatar + Status -->
          <div class="admin-card-header">
            <div class="admin-avatar-wrapper">
              <img src="<%= ambassador.img_url %>" alt="<%= ambassador.name %>">
              <% if(ambassador.isOnline){ %>
                <span class="admin-status-indicator" title="Online"></span>
              <% } %>
            </div>
            <div class="admin-info-primary">
              <h4 title="<%= ambassador.name %>" class="ambassador-name"><%= ambassador.name %></h4>
              <span class="admin-designation-badge bg-info text-white"><%= ambassador.badge %></span>
            </div>
          </div>

          <!-- Body: Ambassador Details Grid -->
          <div class="admin-card-body">
            <div class="admin-details-grid">
              
              <!-- Ambassador ID -->
              <div class="admin-detail-item">
                <div class="admin-detail-icon"><i class="bi bi-person-badge"></i></div>
                <div class="admin-detail-content">
                  <div class="admin-detail-label">Ambassador ID</div>
                  <div class="admin-detail-value ambassador-id" title="<%= ambassador.ambassador_id %>"><%= ambassador.ambassador_id %></div>
                </div>
              </div>

              <!-- Referral ID & Interns Referred -->
              <div class="d-flex gap-2">
                <div class="admin-detail-item flex-fill px-2">
                  <div class="admin-detail-icon" style="width:20px; font-size: 0.9rem;"><i class="bi bi-hash"></i></div>
                  <div class="admin-detail-content">
                    <div class="admin-detail-label">Referral ID</div>
                    <div class="admin-detail-value" style="font-size: 0.75rem;"><%= ambassador.referralId %></div>
                  </div>
                </div>
                <div class="admin-detail-item flex-fill px-2">
                  <div class="admin-detail-icon" style="width:20px; font-size: 0.9rem;"><i class="bi bi-people-fill"></i></div>
                  <div class="admin-detail-content">
                    <div class="admin-detail-label">Interns</div>
                    <div class="admin-detail-value" style="font-size: 0.75rem;"><%= ambassador.internCount %></div>
                  </div>
                </div>
              </div>

              <!-- Email -->
              <div class="admin-detail-item">
                <div class="admin-detail-icon"><i class="bi bi-envelope"></i></div>
                <div class="admin-detail-content">
                  <div class="admin-detail-label">Email</div>
                  <div class="admin-detail-value" title="<%= ambassador.email %>"><%= ambassador.email %></div>
                </div>
              </div>
              
              <!-- College -->
              <div class="admin-detail-item">
                <div class="admin-detail-icon"><i class="bi bi-building"></i></div>
                <div class="admin-detail-content">
                  <div class="admin-detail-label">College</div>
                  <div class="admin-detail-value" style="white-space: normal; word-break: break-word; font-size: 0.8rem;" title="<%= ambassador.college %>"><%= ambassador.college %></div>
                </div>
              </div>

              <!-- Phone & Joined -->
              <div class="d-flex gap-2">
                <div class="admin-detail-item flex-fill px-2">
                  <div class="admin-detail-icon" style="width:20px; font-size: 0.9rem;"><i class="bi bi-telephone"></i></div>
                  <div class="admin-detail-content">
                    <div class="admin-detail-label">Phone</div>
                    <div class="admin-detail-value" style="font-size: 0.75rem;"><%= ambassador.phone %></div>
                  </div>
                </div>
                <div class="admin-detail-item flex-fill px-2">
                  <div class="admin-detail-icon" style="width:20px; font-size: 0.9rem;"><i class="bi bi-calendar3"></i></div>
                  <div class="admin-detail-content">
                    <div class="admin-detail-label">Joined</div>
                    <div class="admin-detail-value" style="font-size: 0.75rem;">
                      <%= new Date(ambassador.joining_date).toLocaleDateString("en-GB", { day:"2-digit", month:"2-digit", year:"2-digit" }).replace(/\//g, "-") %>
                    </div>
                  </div>
                </div>
              </div>

            </div>
          </div>

          <!-- Footer: Action Buttons -->
          <div class="admin-card-footer">
            <a href="/superAdmin/ambassador/<%= ambassador._id %>" class="admin-action-btn admin-action-view" title="View Profile" target="_blank">
              <i class="bi bi-eye"></i>
            </a>
            <button class="admin-action-btn admin-action-edit" title="Update Ambassador" data-bs-toggle="modal" data-bs-target="#updateAmbassadorModal<%= ambassador._id %>">
              <i class="bi bi-pencil-square"></i>
            </button>
            <button class="admin-action-btn admin-action-delete" title="Delete Ambassador" data-bs-toggle="modal" data-bs-target="#deleteAmbassadorModal<%= ambassador._id %>">
              <i class="bi bi-trash"></i>
            </button>
          </div>
        </div>
      </div>
    <% }) %>
  </div>

</section>

      <!-- View Admins -->
     <section id="viewAdmin" style="display:none;">
  <h4 class="section-title mb-3">List of Employees / Admin</h4>

  <div class="row row-cols-1 row-cols-md-3 g-4">
    <% admins.forEach(admin => { %>
      <div class="col">
        <div class="admin-card-modern">
          
          <!-- Header: Background Gradient + Avatar + Status -->
          <div class="admin-card-header">
            <div class="admin-avatar-wrapper">
              <img src="<%= admin.img_url %>" alt="<%= admin.name %>">
              <% if(admin.isOnline){ %>
                <span class="admin-status-indicator" title="Online"></span>
              <% } %>
            </div>
            <div class="admin-info-primary">
              <h4 title="<%= admin.name %>"><%= admin.name %></h4>
              <span class="admin-designation-badge"><%= admin.designation %></span>
            </div>
          </div>

          <!-- Body: Admin Details Grid -->
          <div class="admin-card-body">
            <div class="admin-details-grid">
              
              <!-- ID -->
              <div class="admin-detail-item">
                <div class="admin-detail-icon"><i class="bi bi-person-badge"></i></div>
                <div class="admin-detail-content">
                  <div class="admin-detail-label">Employee ID</div>
                  <div class="admin-detail-value"><%= admin.emp_id %></div>
                </div>
              </div>

              <!-- Domain -->
              <div class="admin-detail-item">
                <div class="admin-detail-icon"><i class="bi bi-briefcase"></i></div>
                <div class="admin-detail-content">
                  <div class="admin-detail-label">Domain</div>
                  <div class="admin-detail-value" title="<%= admin.domain %>"><%= admin.domain %></div>
                </div>
              </div>

              <!-- Email -->
              <div class="admin-detail-item">
                <div class="admin-detail-icon"><i class="bi bi-envelope"></i></div>
                <div class="admin-detail-content">
                  <div class="admin-detail-label">Email</div>
                  <div class="admin-detail-value" title="<%= admin.email %>"><%= admin.email %></div>
                </div>
              </div>

              <!-- Phone & Joined -->
              <div class="d-flex gap-2">
                <div class="admin-detail-item flex-fill px-2">
                  <div class="admin-detail-icon" style="width:20px; font-size: 0.9rem;"><i class="bi bi-telephone"></i></div>
                  <div class="admin-detail-content">
                    <div class="admin-detail-label">Phone</div>
                    <div class="admin-detail-value" style="font-size: 0.75rem;"><%= admin.phone %></div>
                  </div>
                </div>
                <div class="admin-detail-item flex-fill px-2">
                  <div class="admin-detail-icon" style="width:20px; font-size: 0.9rem;"><i class="bi bi-calendar3"></i></div>
                  <div class="admin-detail-content">
                    <div class="admin-detail-label">Joined</div>
                    <div class="admin-detail-value" style="font-size: 0.75rem;">
                      <%= new Date(admin.joining_date).toLocaleDateString("en-GB", { day:"2-digit", month:"2-digit", year:"2-digit" }).replace(/\//g, "-") %>
                    </div>
                  </div>
                </div>
              </div>

            </div>
          </div>

          <!-- Footer: Action Buttons -->
          <div class="admin-card-footer">
            <a href="/superAdmin/admin/<%= admin._id %>" class="admin-action-btn admin-action-view" title="View Profile" target="_blank">
              <i class="bi bi-eye"></i>
            </a>
            <button class="admin-action-btn admin-action-edit" title="Update Admin" data-bs-toggle="modal" data-bs-target="#updateAdminModal<%= admin._id %>">
              <i class="bi bi-pencil-square"></i>
            </button>
            <button class="admin-action-btn admin-action-delete" title="Delete Admin" data-bs-toggle="modal" data-bs-target="#deleteAdminModal<%= admin._id %>">
              <i class="bi bi-trash"></i>
            </button>
          </div>
        </div>
      </div>
    <% }) %>
  </div>

</section>

      <!-- View Interns -->
     <section id="viewInterns" style="display:none;">
  <div class="container px-0">
    <div class="card shadow-sm border rounded p-3" style="border: 1px solid #ff6600 !important;">

      <!-- Section Header -->
      <h4 class="text-center mb-3">Total Interns</h4>

      <!-- Filters Row -->
      <div class="row mb-3 g-2 justify-content-center flex-grow-1">
        <div class="col-md-2">
          <select id="batchFilter" class="form-select" onchange="applyInternFilters()">
            <option value="all" selected>All Batches</option>
            <% batches.forEach(batch => { %>
              <option value="<%= batch %>">Batch <%= batch %></option>
            <% }) %>
          </select>
        </div>

         <!-- Domain Filter -->
  <div class="col-md-2">
    <select id="domainFilter" class="form-select" onchange="applyInternFilters()">
      <option value="all" selected>All Domains</option>
    <% 
  const internDomains = interns && Array.isArray(interns) ? [...new Set(interns.map(i => i.domain))] : [];
  internDomains.forEach(domain => { 
%>
  <option value="<%= domain.toLowerCase() %>"><%= domain %></option>
<% }) %>

    </select>
  </div>

 <!-- Duration Filter -->
<div class="col-md-2">
  <select id="durationFilter" class="form-select" onchange="applyInternFilters()">
    <option value="all" selected>All Durations</option>
    <% 
      const internDurations = interns && Array.isArray(interns) ? [...new Set(interns.map(i => i.duration))].sort((a, b) => a - b) : [];
      internDurations.forEach(duration => { 
    %>
      <option value="<%= duration %>"><%= duration %> Weeks</option>
    <% }) %>
  </select>
</div>

        <div class="col-md-2 flex-grow-1">
          <input type="text" id="internSearchInput" class="form-control" placeholder="Search by Name or ID" onkeyup="applyInternFilters()">
        </div>
        <div class="col-md-2">
          <button class="btn btn-secondary w-100" onclick="clearInternFilters()">Clear Filters</button>
        </div>
      </div>

      <!-- Intern Table -->
      <div class="table-responsive" style="max-height: 500px; overflow-y: auto;">
        <table class="table table-striped table-bordered align-middle text-center mb-0">
          <thead class="table-light" style="position: sticky; top: 0; z-index: 2; background-color: #f8f9fa;">
             <tr class="text-center">
               <th style="width: 60px;">S.No</th>
               <th style="width: 5rem;">Profile</th>
               <th>Name</th>
               <th>Email</th>
               <th>Duration</th>
               <th>Intern ID</th>
               <th>Batch</th>
               <th style="min-width: 7.5rem !important;">Actions</th>
             </tr>
           </thead>
          <tbody>
            <% interns.forEach((i, index) => { %>
              <tr class="intern-row" data-batch="<%= i.batch_no %>"  data-duration="<%= i.duration %>" data-domain="<%= i.domain.toLowerCase() %>">
                <td class="serial-no" style="padding:0 !important;"><%= index + 1 %></td>
                 <td style="padding:0 !important;" class="position-relative">
                    <div class="position-relative d-inline-block">
                  
                      <img src="<%= i.img_url %>" 
                           alt="<%= i.name %>" 
                           class="rounded-circle"
                           style="width:40px; height:40px; object-fit:cover;">
                  
                      
                  
                    </div>
                    <% if(i.isOnline){ %>
                        <span class="position-absolute top-5 end-1  
                                     p-1 bg-success border border-light rounded-circle">
                        </span>
                      <% } %>
                  </td>

                 <td style="text-align: left !important; padding-left: 1rem;"><%= i.name %></td>
                 <td style="text-align: left !important; padding-left: 1rem;"><%= i.email %></td>
                 <td style="padding:0 !important;"><%= i.duration %> Weeks</td>
                 <td class="intern-id"><%= i.intern_id %></td>
                 <td ><%= i.batch_no %></td>
                <td class="d-flex justify-content-evenly gap-2">
                  <a href="/admin/intern/<%= i._id %>" class="btn btn-outline-primary btn-sm px-3 rounded-pill shadow-sm" target="_blank"><i class="bi bi-eye"></i></a>
                  <!-- <button class="btn btn-outline-secondary btn-sm px-3 rounded-pill" data-bs-toggle="modal" data-bs-target="#updateModal<%= i._id %>">Update</button> -->
                  <button class="btn btn-outline-danger btn-sm px-3 rounded-pill shadow-sm" data-bs-toggle="modal" data-bs-target="#deleteModal<%= i._id %>"><i class="bi bi-trash"></i></button>
                </td>
              </tr>

              <!-- Delete Intern Modal -->
              <div class="modal fade" id="deleteModal<%= i._id %>" tabindex="-1" aria-hidden="true">
                <div class="modal-dialog">
                  <div class="modal-content">
                    <div class="modal-header">
                      <h5 class="modal-title">Delete <%= i.name %>?</h5>
                      <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body">Are you sure you want to delete this intern?</div>
                    <div class="modal-footer">
                      <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                      <form action="/delete-user/<%= i._id %>" method="POST">
                        <button class="btn btn-danger">Delete</button>
                      </form>
                    </div>
                  </div>
                </div>
              </div>

            <% }) %>
          </tbody>
        </table>
      </div>

    </div>
  </div>
</section>

<!-- ================= SCHEDULE MEETING ================= -->
<section id="scheduleMeetingSection" class="container my-5" style="display:none;">
  <div class="row justify-content-center">
    <div class="col-lg-11 col-xl-10">
      
      <!-- Sleek Premium Card -->
      <div class="card border-0 rounded-4" style="background: #ffffff; box-shadow: 0 10px 40px rgba(0,0,0,0.04);">
        <div class="card-body p-4 p-md-5">
          
          <div class="text-center mb-5">
            <h4 class="fw-bold text-dark mb-1" style="font-family: 'Inter', sans-serif; letter-spacing: -0.5px;">Allot Meeting to Interns</h4>
            <div class="mx-auto mt-2" style="width: 40px; height: 3px; background: linear-gradient(90deg, #ff6600, #ff8c00); border-radius: 2px;"></div>
          </div>

          <form action="/allot-meetings" method="POST" class="needs-validation" novalidate>
             <div class="row g-4">
               
               <!-- Domain -->
               <div class="col-sm-6 col-md-3">
                 <div class="form-floating-custom position-relative">
                   <div class="input-group" style="border-radius: 12px; overflow: hidden; border: 1px solid #e2e8f0; background: #f8fafc; transition: all 0.3s ease;" onfocusin="this.style.borderColor='#ff6600'; this.style.boxShadow='0 0 0 3px rgba(255, 102, 0, 0.1)'" onfocusout="this.style.borderColor='#e2e8f0'; this.style.boxShadow='none'">
                     <span class="input-group-text border-0 bg-transparent text-muted ps-3 pe-2"><i class="bi bi-layers-fill"></i></span>
                     <select name="domain" class="form-select border-0 bg-transparent shadow-none ps-1 py-3 text-dark fw-medium" required style="cursor: pointer; font-size: 0.95rem;">
                       <option value="" disabled selected>Select Domain</option>
                       <option value="Web Development">Web Development</option>
                       <option value="Graphics Designing">Graphics Designing</option>
                       <option value="Data Analytics">Data Analytics</option>
                       <option value="DSA">DSA</option>
                       <option value="Java Programming">Java Programming</option>
                       <option value="Python Programming">Python Programming</option>
                       <option value="Full Stack Development">Full Stack Development</option>
                     </select>
                   </div>
                 </div>
               </div>

               <!-- Week -->
               <div class="col-sm-6 col-md-3">
                 <div class="form-floating-custom position-relative">
                   <div class="input-group" style="border-radius: 12px; overflow: hidden; border: 1px solid #e2e8f0; background: #f8fafc; transition: all 0.3s ease;" onfocusin="this.style.borderColor='#ff6600'; this.style.boxShadow='0 0 0 3px rgba(255, 102, 0, 0.1)'" onfocusout="this.style.borderColor='#e2e8f0'; this.style.boxShadow='none'">
                     <span class="input-group-text border-0 bg-transparent text-muted ps-3 pe-2"><i class="bi bi-calendar-week-fill"></i></span>
                     <select name="week" class="form-select border-0 bg-transparent shadow-none ps-1 py-3 text-dark fw-medium" required style="cursor: pointer; font-size: 0.95rem;">
                       <option value="" disabled selected>Week</option>
                       <option value="1">1</option>
                       <option value="2">2</option>
                       <option value="3">3</option>
                       <option value="4">4</option>
                       <option value="6">6</option>
                       <option value="8">8</option>
                     </select>
                   </div>
                 </div>
               </div>

               <!-- Batch -->
               <div class="col-sm-6 col-md-3">
                 <div class="form-floating-custom position-relative">
                   <div class="input-group" style="border-radius: 12px; overflow: hidden; border: 1px solid #e2e8f0; background: #f8fafc; transition: all 0.3s ease;" onfocusin="this.style.borderColor='#ff6600'; this.style.boxShadow='0 0 0 3px rgba(255, 102, 0, 0.1)'" onfocusout="this.style.borderColor='#e2e8f0'; this.style.boxShadow='none'">
                     <span class="input-group-text border-0 bg-transparent text-muted ps-3 pe-2"><i class="bi bi-people-fill"></i></span>
                     <select name="batch_no" class="form-select border-0 bg-transparent shadow-none ps-1 py-3 text-dark fw-medium" required style="cursor: pointer; font-size: 0.95rem;">
                       <option value="" disabled selected>Select Batch</option>
                       <% batches.forEach(batch => { %>
                         <option value="<%= batch %>">Batch <%= batch %></option>
                       <% }) %>
                     </select>
                   </div>
                 </div>
               </div>

               <!-- Title -->
               <div class="col-sm-6 col-md-3">
                 <div class="form-floating-custom position-relative">
                   <div class="input-group" style="border-radius: 12px; overflow: hidden; border: 1px solid #e2e8f0; background: #f8fafc; transition: all 0.3s ease;" onfocusin="this.style.borderColor='#ff6600'; this.style.boxShadow='0 0 0 3px rgba(255, 102, 0, 0.1)'" onfocusout="this.style.borderColor='#e2e8f0'; this.style.boxShadow='none'">
                     <span class="input-group-text border-0 bg-transparent text-muted ps-3 pe-2"><i class="bi bi-card-text"></i></span>
                     <input type="text" name="title" class="form-control border-0 bg-transparent shadow-none ps-1 py-3 text-dark fw-medium" placeholder="Meeting Title" required style="font-size: 0.95rem;">
                   </div>
                 </div>
               </div>

               <!-- Link -->
               <div class="col-md-6 mt-4">
                 <div class="form-floating-custom position-relative">
                   <div class="input-group" style="border-radius: 12px; overflow: hidden; border: 1px solid #e2e8f0; background: #f8fafc; transition: all 0.3s ease;" onfocusin="this.style.borderColor='#ff6600'; this.style.boxShadow='0 0 0 3px rgba(255, 102, 0, 0.1)'" onfocusout="this.style.borderColor='#e2e8f0'; this.style.boxShadow='none'">
                     <span class="input-group-text border-0 bg-transparent text-muted ps-3 pe-2"><i class="bi bi-link-45deg fs-5"></i></span>
                     <input type="url" name="link" class="form-control border-0 bg-transparent shadow-none ps-1 py-3 text-dark fw-medium" placeholder="Meeting Link" required style="font-size: 0.95rem;">
                   </div>
                 </div>
               </div>

               <!-- Scheduled Time -->
               <div class="col-md-6 mt-4">
                 <div class="form-floating-custom position-relative">
                   <div class="input-group" style="border-radius: 12px; overflow: hidden; border: 1px solid #e2e8f0; background: #ffffff; transition: all 0.3s ease;" onfocusin="this.style.borderColor='#ff6600'; this.style.boxShadow='0 0 0 3px rgba(255, 102, 0, 0.1)'" onfocusout="this.style.borderColor='#e2e8f0'; this.style.boxShadow='none'">
                     <span class="input-group-text border-0 bg-transparent ps-3 pe-2"><i class="bi bi-clock-fill text-muted"></i></span>
                     <input type="text" id="meeting_datetime" name="scheduledTime" class="form-control border-0 bg-transparent shadow-none ps-1 py-3 fw-bold text-dark" placeholder="Select date & time" required style="font-size: 0.95rem; cursor: pointer;">
                   </div>
                 </div>
               </div>
             </div>

             <div class="mt-5 text-center">
               <button type="submit" class="btn btn-primary rounded-pill px-5 py-3 shadow-sm fw-bold border-0 d-inline-flex align-items-center justify-content-center gap-2 text-white"
                 style="background: #ff6600; font-size: 1rem; letter-spacing: 0.5px; transition: all 0.2s ease-in-out;"
                 onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 8px 15px rgba(255, 102, 0, 0.25)';" 
                 onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 .125rem .25rem rgba(0,0,0,.075)';">
                 Allot Meeting
               </button>
             </div>
          </form>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- ================= MANAGE MEETINGS ================= -->
<section id="manageMeetingsSection" class="container my-4" style="display:none;">

  <!-- Batch Filter -->
<div class="mb-3 d-flex flex-column flex-md-row align-items-start align-items-md-center gap-2">
  <label for="batchFilter" class="fw-bold mb-1 mb-md-0">Filter by Batch:</label>
  <select id="Meeting_batchFilter" class="form-select w-auto">
    <option value="all" selected>All Batches</option>
    <% batches.slice().sort((a, b) => a - b).forEach(batch => { %>
      <option value="<%= batch %>">Batch <%= batch %></option>
    <% }) %>
  </select>
</div>


  <!-- Meetings Table -->
  <div class="table-responsive shadow-sm " style="max-height: 500px; overflow-y: auto;">
    <table class="table table-striped table-bordered align-middle text-center mb-0" style="min-width: 700px;">
      <thead class="table-light" style="position: sticky; top: 0; z-index: 2;">
        <tr>
          <th>Title</th>
          <th>Domain</th>
          <th>Week</th>
          <th>Scheduled Time</th>
          <th>Status</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody id="meetingsTableBody">
        <% meetings.forEach(meeting => { %>
        <tr data-batch="<%= meeting.batch_no %>">
          <td class="text-truncate" style="max-width: 150px;"><%= meeting.title %></td>
          <td><%= meeting.domain %></td>
          <td><%= meeting.week %></td>
          <td><%= new Date(meeting.scheduledTime).toLocaleString() %></td>
          <td>
            <span class="badge <%= meeting.status === 'upcoming' ? 'bg-success' : (meeting.status==='completed' ? 'bg-secondary' : 'bg-danger') %>">
              <%= meeting.status.charAt(0).toUpperCase() + meeting.status.slice(1) %>
            </span>
          </td>
          <td class="d-flex justify-content-evenly flex-wrap gap-1">
            <button class="btn btn-outline-success btn-sm px-3 rounded-pill shadow-sm" data-bs-toggle="modal" data-bs-target="#updateMeetingModal<%= meeting._id %>">Update</button>
            <button class="btn btn-outline-danger btn-sm px-3 rounded-pill shadow-sm" data-bs-toggle="modal" data-bs-target="#deleteMeetingModal<%= meeting._id %>">Delete</button>
          </td>
        </tr>

        <!-- Update Meeting Modal -->
        <div class="modal fade mt-0" id="updateMeetingModal<%= meeting._id %>" tabindex="-1" aria-hidden="true">
          <div class="modal-dialog">
            <div class="modal-content">
              <div class="modal-header">
                <h5 class="modal-title">Update <%= meeting.title %></h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
              </div>
              <form action="/update-meeting/<%= meeting._id %>" method="POST">
                <div class="modal-body">
                  <input type="hidden" name="domain" value="<%= meeting.domain %>">
                  <label class="form-label">Batch No.</label>
                  <select name="batch_no" class="form-select" required>
                    <% batches.forEach(batch => { %>
                      <option value="<%= batch %>" <%= batch == meeting.batch_no ? "selected" : "" %>>Batch <%= batch %></option>
                    <% }) %>
                  </select>

                  <label class="form-label mt-2">Title</label>
                  <input type="text" name="title" class="form-control mb-2" value="<%= meeting.title %>" required>

                  <label class="form-label">Link</label>
                  <input type="url" name="link" class="form-control mb-2" value="<%= meeting.link %>" required>

                  <label class="form-label">Week</label>
                  <select name="week" class="form-select mb-2" required>
                    <option value="1" <%= meeting.week==1 ? "selected" : "" %>>1</option>
                    <option value="2" <%= meeting.week==2 ? "selected" : "" %>>2</option>
                    <option value="3" <%= meeting.week==3 ? "selected" : "" %>>3</option>
                    <option value="4" <%= meeting.week==4 ? "selected" : "" %>>4</option>
                    <option value="6" <%= meeting.week==6 ? "selected" : "" %>>6</option>
                    <option value="8" <%= meeting.week==8 ? "selected" : "" %>>8</option>
                  </select>

                  <label class="form-label">Scheduled Time</label>
                  <input type="text" id="meeting_datetime" name="scheduledTime" class="form-control mb-2" placeholder="Select date & time" value="<%= meeting.scheduledTime.toISOString().slice(0,16) %>" required>

                  <label class="form-label">Status</label>
                  <select name="status" class="form-select mb-2" required>
                    <option value="upcoming" <%= meeting.status === "upcoming" ? "selected" : "" %>>Upcoming</option>
                    <option value="completed" <%= meeting.status === "completed" ? "selected" : "" %>>Completed</option>
                    <option value="cancelled" <%= meeting.status === "cancelled" ? "selected" : "" %>>Cancelled</option>
                  </select>
                </div>
                <div class="modal-footer">
                  <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                  <button type="submit" class="btn btn-primary">Update</button>
                </div>
              </form>
            </div>
          </div>
        </div>
        <% }) %>
      </tbody>
    </table>
  </div>
</section>


















<!-- ================= CONFIRMATION MAIL ================= -->
<section id="confirmationMail" style="display:none; background-color: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); border: 1px solid #ff6600 !important;">
  <h4 class="text-center mb-4">Send Confirmation Mail</h4>

  <form action="/send-confirmation-mail" method="POST" id="confirmationForm" class="needs-validation" novalidate>
    <!-- Filters + WhatsApp + Send Button in one row -->
    <div class="d-flex flex-wrap align-items-end gap-2 mb-3">
      
      <div class="flex-grow-0">
        <select id="filterConfirm" class="form-select" onchange="applyFilters('confirm')">
          <option value="all">Show All</option>
          <option value="sent">Sent</option>
          <option value="notSent">Pending</option>
        </select>
      </div>

      <div class="flex-grow-0">
        <select id="batchConfirm" name="batchConfirm" class="form-select" onchange="applyFilters('confirm')" >
          <option value="all" selected>All Batches</option>
          <% batches.forEach(batch => { %>
            <option value="<%= batch %>"><%= batch %></option>
          <% }) %>
        </select>
      </div>

      <div class="flex-grow-1">
        <input type="text" id="searchConfirm" class="form-control" placeholder="Search by name or email" onkeyup="applyFilters('confirm')">
      </div>

      <div class="flex-grow-1">
        <input type="text" name="whatsappLink" id="whatsappLink" class="form-control" placeholder="WhatsApp Group Link" required>
      </div>

      <div class="flex-grow-0">
        <button type="button" class="btn btn-secondary" onclick="clearFilters('confirm')">Clear Filters</button>
      </div>

      <div class="flex-grow-0">
        <button class="btn btn-success" type="submit">Send Mail</button>
      </div>
    </div>

    <table class="table table-bordered">
      <thead>
        <tr>
          <th>Name</th>
          <th>Email</th>
          <th>Batch</th>
          <th>Status</th>
          <th class="text-center"><input type="checkbox" id="selectAllConfirm" onclick="toggleSelectAll('confirm')" class="form-check-input"></th>
        </tr>
      </thead>
      <tbody id="confirmTable">
        <% interns.forEach(i => { %>
          <tr data-status="<%= i.confirmationSent ? 'sent' : 'notSent' %>" 
              data-batch="<%= i.batch_no %>" 
              data-name="<%= i.name.toLowerCase() %>" 
              data-email="<%= i.email.toLowerCase() %>"
              class="<%= i.confirmationSent ? 'row-sent' : 'row-notSent' %>">
            <td><%= i.name %></td>
            <td><%= i.email %></td>
            <td><%= i.batch_no %></td>
            <td><%= i.confirmationSent ? 'Sent' : 'Not Sent' %></td>
            <td class="text-center">
              <% if (i.confirmationSent) { %>
                <input type="checkbox" disabled>
              <% } else { %>
                <input type="checkbox" name="interns[]" value="<%= i.intern_id %>" class="confirmCheckbox form-check-input">
              <% } %>
            </td>
          </tr>
        <% }) %>
      </tbody>
    </table>

  </form>
</section>

<!-- Certified Interns Section -->
<section id="completedInterns" style="display:none;">
  <div class="container px-0">
    <div class="card shadow-sm border rounded p-3 " style="border: 1px solid #ff6600 !important;">

      <!-- Section Header -->
      <h4 class="text-center mb-3">Certified Interns</h4>

      <!-- Filters Row -->
      <div class="row mb-3 g-2 justify-content-center flex-grow-1">
        <div class="col-md-2">
          <select id="batchFilterCompleted" class="form-select" onchange="applyCompletedFilters()">
            <option value="all" selected>All Batches</option>
            <% batches.forEach(batch => { %>
              <option value="<%= batch %>">Batch <%= batch %></option>
            <% }) %>
          </select>
        </div>

        <div class="col-md-2">
          <select id="domainFilterCompleted" class="form-select" onchange="applyCompletedFilters()">
            <option value="all" selected>All Domains</option>
            <% let domains = interns && Array.isArray(interns) ? [...new Set(interns.map(i => i.domain))] : []; %>
            <% domains.forEach(domain => { %>
              <option value="<%= domain %>"><%= domain %></option>
            <% }) %>
          </select>
        </div>

        <!-- Duration Filter -->
        <div class="col-md-2">
          <select id="durationFilterCompleted" class="form-select" onchange="applyCompletedFilters()">
            <option value="all" selected>All Durations</option>
            <% 
              const completedDurations = interns && Array.isArray(interns) ? [...new Set(interns.map(i => i.duration))].sort((a, b) => a - b) : [];
              completedDurations.forEach(duration => { 
            %>
              <option value="<%= duration %>"><%= duration %> Weeks</option>
            <% }) %>
          </select>
        </div>

        <div class="col-md-2 flex-grow-1">
          <input type="text" id="completedSearchInput" class="form-control" placeholder="Search by Intern ID" onkeyup="applyCompletedFilters()">
        </div>

        <div class="col-md-2">
          <button class="btn btn-secondary w-100" onclick="clearCompletedFilters()">Clear Filters</button>
        </div>
      </div>

      <!-- Intern Table -->
      <div class="table-responsive" style="max-height: 500px; overflow-y: auto;">
        <table class="table table-striped table-bordered align-middle text-center mb-0">
          <thead class="table-light" style="position: sticky; top: 0; z-index: 2; background-color: #fff;">
            <tr>
              <th>S.No.</th>
              <th>Name</th>
              <th>Domain</th>
              <th>Batch</th>
              <th>Duration</th>
              <th>Intern ID</th>
              <th>Quiz Score</th>
              <th>Status</th>
              <th>Screenshot</th>
              <th>Update</th>
            </tr>
          </thead>

          <tbody id="completedInternTable">
            <% let completedSerial = 0; %>
            <% interns
              .filter(i => i.intern_progress === 100 && i.quizAssignments.length != 0)
              .forEach(i => { %>
              <% completedSerial++; %>

              <tr class="completed-intern-row"
                  data-batch="<%= i.batch_no %>"
                  data-domain="<%= i.domain %>"
                  data-duration="<%= i.duration %>"
                  data-id="<%= i._id %>">

                <td class="serial-no"><%= completedSerial %></td>
                <td style="text-align: left !important; padding-left: 1rem;"><%= i.name %></td>
                <td><%= i.domain %></td>
                <td><%= i.batch_no %></td>
                <td><%= i.duration %> Weeks</td>
                <td class="intern-id"><%= i.intern_id %></td>
                <td class="quiz-score"><%= i.quiz_score %></td>

                <td class="status-cell">
                  <% if (i.quizAssignments && i.quizAssignments.some(q => q && q.attemptCount >= 1)) { %>
                    <% if (i.isPassed) { %>
                      <span class="badge bg-success">Pass</span>
                    <% } else { %>
                      <span class="badge bg-danger">Fail</span>
                    <% } %>
                  <% } %>
                </td>

                <td>
                  <% if (i.screenshot_img) { %>
                    <button class="btn btn-outline-primary btn-sm" data-bs-toggle="modal" data-bs-target="#screenshotModal<%= i._id %>">
                      <i class="bi bi-eye"></i> View
                    </button>

                    <!-- Screenshot Modal -->
                    <div class="modal fade" id="screenshotModal<%= i._id %>" tabindex="-1" aria-hidden="true">
                      <div class="modal-dialog modal-dialog-centered modal-lg">
                        <div class="modal-content">
                          <div class="modal-header">
                            <h5 class="modal-title">Screenshot - <%= i.name %></h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                          </div>
                          <div class="modal-body text-center">
                            <img src="<%= i.screenshot_img %>" alt="Screenshot" class="img-fluid">
                          </div>
                        </div>
                      </div>
                    </div>
                  <% } else { %>
                    <span class="text-muted" style="font-size: 0.8rem;">N/A</span>
                  <% } %>
                </td>

                <!-- Update Button & Modal -->
                <td>
                  <button class="btn btn-outline-secondary btn-sm px-3 rounded-pill"
                          data-bs-toggle="modal"
                          data-bs-target="#updateModal<%= i._id %>">
                     Update
                  </button>
                </td>
              </tr>

              </tr>

            <% }) %>
          </tbody>
        </table>
      </div>

    </div>
  </div>
</section>

<!-- Registrations Section -->
<section id="registration" style="display:none;">
  <div class="container px-0">
    <div class="card shadow-sm border rounded p-3" style="border: 1px solid #ff6600 !important;">

      <!-- Section Header -->
      <h4 class="text-center mb-3">Internship Registrations</h4>

      <!-- Registrations Table -->
      <div class="table-responsive" style="max-height: 500px; overflow-y: auto;">
        <table class="table table-striped table-bordered align-middle text-center mb-0">
          <thead class="table-light" style="position: sticky; top: 0; z-index: 2;background-color: #fff">
            <tr>
              <th>Name</th>
              <th>Email</th>
              <th>Domain</th>
              <th>Duration</th>
              <th>Transaction ID</th>
              <th>Status</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody id="registrationTable">
            <% registrations.forEach(reg => { %>
              <tr>
                <td><%= reg.name %></td>
                <td><%= reg.email %></td>
                <td><%= reg.domain %></td>
                <td><%= reg.duration %> Weeks</td>
                <td><%= reg.payID || 'N/A' %></td>
                <td><% if (reg.payment_status === 'SUCCESS') { %>
                      <span class="badge bg-success">Success</span>
                    <% } else if (reg.payment_status === 'FAILED') { %>
                      <span class="badge bg-danger">Failed</span>
                    <% } else { %>
                      <span class="badge bg-warning">Pending</span>
                    <% } %>
                </td>
                <td>
                  <button class="btn btn-outline-primary btn-sm px-3 py-0 rounded-pill" data-bs-toggle="modal" data-bs-target="#viewRegModal<%= reg._id %>">
                    <i class="bi bi-eye" style="font-size: large;"></i>
                  </button>
                  <button class="btn btn-outline-success btn-sm px-3 py-0 rounded-pill" onclick="approveReject('<%= reg._id %>', 'approve', this)"><i class="bi bi-check-lg" style="font-size: large;"></i></button>
                  <button class="btn btn-outline-danger btn-sm px-3 py-0 rounded-pill" onclick="approveReject('<%= reg._id %>', 'reject', this)"><i class="bi bi-x-lg" style="font-size: large;"></i></button>
                </td>
              </tr>
            <% }) %>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</section>



<script>
function updateIntern(id) {

    const data = {
        isPassed: document.getElementById(`isPassed-${id}`).value,
        quiz_score: document.getElementById(`quizScore-${id}`).value,
        attemptCount: document.getElementById(`attemptCount-${id}`).value,
        assignmentScore: document.getElementById(`assignmentScore-${id}`).value,
        certificate_id: document.getElementById(`certificateId-${id}`).value,
        certificate_link: document.getElementById(`certificateLink-${id}`).value,
        starting_date: document.getElementById(`startingDate-${id}`).value,
        completion_date: document.getElementById(`completionDate-${id}`).value
    };

    fetch(`/superAdmin/updateIntern/${id}`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(data)
    })
    .then(res => res.json())
    .then(res => {
        if (res.success) {

            // Update UI in table
            const row = document.querySelector(`tr[data-id="${id}"]`);
            if (row) {
                row.querySelector(".quiz-score").innerText = data.quiz_score;

                row.querySelector(".status-cell").innerHTML =
                    data.isPassed === "true"
                        ? '<span class="badge bg-success">Pass</span>'
                        : '<span class="badge bg-danger">Fail</span>';
            }

            // Close modal smoothly
            const modalEl = document.getElementById(`updateModal${id}`);
            const modal = bootstrap.Modal.getOrCreateInstance(modalEl);
            modal.hide();
        }
    })
    .catch(err => {
        console.error("Update Error:", err);
    });
}
</script>


<!-- ================= COMPLETION MAIL ================= -->
<section id="completionMail" style="display:none; background-color: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); border: 1px solid #ff6600 !important;">
  <h4 class="text-center mb-4">Send Internship Completion Mail</h4>

  <form action="/send-completion-mail" method="POST" id="completionForm">
    <!-- Filters + Button Row -->
    <div class="row g-2 mb-3 align-items-center">
      <div class="col-12 col-sm-auto flex-sm-grow-1">
        <select id="batchCompletion" class="form-select" onchange="applyFilters('completion')">
          <option value="all" selected>All Batches</option>
          <% batches.forEach(batch => { %>
            <option value="<%= batch %>">Batch <%= batch %></option>
          <% }) %>
        </select>
      </div>

      <div class="col-12 col-sm-auto flex-sm-grow-1">
        <input type="text" id="searchCompletion" class="form-control" placeholder="Search by name or email" onkeyup="applyFilters('completion')">
      </div>

      <div class="col-6 col-sm-auto ">
        <button type="button" class="btn btn-secondary w-100" onclick="clearFilters('completion')">Clear Filters</button>
      </div>

      <div class="col-6 col-sm-auto">
        <button class="btn btn-success w-100" type="submit">Send Mail</button>
      </div>
    </div>

    <div class="table-responsive" style="max-height: 500px; overflow-y: auto; overflow-x: auto;">
      <table class="table table-striped table-bordered">
        <thead style="position: sticky; top: 0; background: #f8f9fa; z-index: 1;">
          <tr>
            <th style="width: 60px;">S.No</th>
            <th>Name</th>
            <th>Email</th>
            <th>Week</th>
            <th>Batch</th>
            <th class="text-center">
              <input type="checkbox" id="selectAllCompletion" onclick="toggleSelectAll('completion')" class="form-check-input">
            </th>
          </tr>
        </thead>
        <tbody id="completionTable">
          <% 
          let serialNo = 1;
          (interns && Array.isArray(interns) ? interns.filter(i => i.isPassed && !i.completionSent) : []).forEach(i => { 
          %>
            <tr data-status="<%= i.completionSent ? 'sent' : 'notSent' %>"
                data-batch="<%= i.batch_no %>" 
                data-name="<%= i.name.toLowerCase() %>" 
                data-email="<%= i.email.toLowerCase() %>"
                style="display: none;">
              <td class="serial-no"><%= serialNo++ %></td>
              <td><%= i.name %></td>
              <td><%= i.email %></td>
              <td><%= i.duration %> Weeks</td>
              <td><%= i.batch_no %></td>
              <td class="text-center">
                <input type="checkbox" name="interns[]" value="<%= i.intern_id %>" class="completionCheckbox form-check-input">
              </td>
            </tr>
          <% }) %>
          <!-- Initial state message -->
          <tr id="addFiltersMessage" style="display: none;">
            <td colspan="5" class="text-center py-5 text-muted">
              <i class="bi bi-funnel fs-3 d-block mb-2"></i>
              Add filters to see data
            </td>
          </tr>
          <!-- No data available message -->
          <tr id="noDataMessage" style="display: none;">
            <td colspan="5" class="text-center py-5 text-muted">
              <i class="bi bi-exclamation-circle fs-3 d-block mb-2"></i>
              No data available
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </form>
</section>

<!-- ================= OFFER LETTER MAIL ================= -->

<section id="offerLetterMail" style="display:none; background-color: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); border:1px solid #ff6600 !important">
  <h4 class="text-center mb-4">Send Offer Letter Mail</h4>

  <form action="/send-offerletter-mail" method="POST" id="offerLetterForm" class="needs-validation" novalidate>
    <!-- Filters + Search + Send Button in one row -->
    <div class="row g-2 mb-3 align-items-center">
      
      <div class="col-12 col-sm-auto">
        <select id="filterOfferLetter" class="form-select" onchange="applyFilters('offerLetter')">
          <option value="sent">Sent</option>
          <option value="notSent" selected>Pending</option>
        </select>
      </div>

      <div class="col-12 col-sm-auto">
        <select id="batchOfferLetter" class="form-select" onchange="applyFilters('offerLetter')">
          <option value="all" selected>All Batches</option>
          <% batches.forEach(batch => { %>
            <option value="<%= batch %>"><%= batch %></option>
          <% }) %>
        </select>
      </div>

      <div class="col-12 col-sm-auto flex-sm-grow-1 mt-2 mt-sm-0">
        <input type="text" id="searchOfferLetter" class="form-control" placeholder="Search by name or email" onkeyup="applyFilters('offerLetter')">
      </div>

      <div class="col-6 col-sm-auto">
        <button type="button" class="btn btn-secondary w-100" onclick="clearFilters('offerLetter')">Clear Filters</button>
      </div>

      <div class="col-6 col-sm-auto">
        <button class="btn btn-success w-100" type="submit">Send Mail</button>
      </div>
    </div>

    <div class="table-responsive">
      <table class="table table-bordered mb-0">
        <thead>
          <tr>
            <th>Name</th>
            <th>Email</th>
            <th>Intern ID</th>
            <th>Batch</th>
            <th>Status</th>
            <th class="text-center"><input type="checkbox" id="selectAllOfferLetter" onclick="toggleSelectAll('offerLetter')" class="form-check-input"></th>
          </tr>
        </thead>
        <tbody id="offerLetterTable">
          <% interns.forEach(i => { %>
            <tr data-status="<%= i.offer_letter_sent ? 'sent' : 'notSent' %>" 
                data-batch="<%= i.batch_no %>" 
                data-name="<%= i.name.toLowerCase() %>" 
                data-email="<%= i.email.toLowerCase() %>"
                class="<%= i.offer_letter_sent ? 'row-sent' : 'row-notSent' %>">
              <td><%= i.name %></td>
              <td><%= i.email %></td>
              <td><%= i.intern_id %></td>
              <td><%= i.batch_no %></td>
              <td><%= i.offer_letter_sent ? 'Sent' : 'Not Sent' %></td>
              <td class="text-center" style="padding-left: 5px !important;">
                <% if (i.offer_letter_sent) { %>
                  <input type="checkbox" disabled>
                <% } else { %>
                  <input type="checkbox" name="interns[]" value="<%= i.intern_id %>" class="offerLetterCheckbox form-check-input" onclick="updateRowColor(this, 'offerLetter')">
                <% } %>
              </td>
            </tr>
          <% }) %>
        </tbody>
      </table>
    </div>
  </form>
</section>

<!-- Logout Confirmation Modal -->
<div class="modal fade" id="logoutModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog" style="margin-top: 10vh;"> <!-- Adjust top margin -->
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Confirm Logout</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        Do you really want to log out?
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
        <a href="/logout" class="btn btn-danger">Logout</a>
      </div>
    </div>
  </div>
</div>

<!-- First Login Password Reset -->

  <% if (showPasswordPopup) { %>
<div class="modal fade" id="passwordModal" tabindex="-1" aria-labelledby="passwordModalLabel" aria-hidden="true"
     data-bs-backdrop="static" data-bs-keyboard="false">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content shadow-lg" style="background-color: #1e1e1e; border: 1px solid #ff6600;">
      <div class="modal-header">
        <h5 class="modal-title text-white" id="passwordModalLabel">Change Your Password</h5>
      </div>
      <div class="modal-body">
        <form action="/intern/change-password" method="POST" id="passwordForm" novalidate>
          <div class="mb-3">
            <label class="form-label text-white">New Password</label>
            <input type="password" name="newPassword" class="form-control" placeholder="Enter new Password" minlength="6">
          </div>
          <div class="mb-3">
            <label class="form-label text-white">Confirm Password</label>
            <input type="password" name="confirmPassword" class="form-control"placeholder="Confirm Password" required minlength="6">
          </div>
          <button type="submit" class="btn w-100 text-white" style="background-color: #ff6600; font-weight: 500;">Update Password</button>
        </form>
      </div>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script>
  const passwordModalEl = document.getElementById('passwordModal');
  const passwordModal = new bootstrap.Modal(passwordModalEl, {
    backdrop: 'static',
    keyboard: false
  });
  passwordModal.show();

</script>
<% } %>


<!-- Profile Picture Change Modal -->
  <div class="modal fade" id="updateProfileModal" tabindex="-1" aria-labelledby="updateProfileLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content" style="background-color: #1e1e1e ;border: 1px solid #ff6600;">
      <div class="modal-header">
        <h5 class="modal-title text-white" id="updateProfileLabel">Update Profile Picture</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body text-center">
        <!-- Image Preview -->
        <div class="mb-3">
          <img id="previewImage" src="<%= superAdmin.img_url %>" 
               style="width: 120px; height: 120px; border-radius: 50%; object-fit: cover;" 
               alt="Preview">
        </div>

        <!-- Upload Form -->
        <form action="/update-image" method="POST" enctype="multipart/form-data" id="updateImageForm">
          <input type="file" name="image" id="imageInput" class="form-control mb-3" accept="image/*" required>
          <button type="submit" class="btn  w-100 text-white" style="background-color: #ff6600;">Update Picture</button>
        </form>
      </div>
    </div>
  </div>
</div>





    </div> <!-- end content-body -->
  </div> <!-- end main-content -->
  <%- include("partials/toaster") %>
  
  <script src="/bootstrap/js/bootstrap.bundle.min.js"></script>
  <script src="/js/superAdmin.js"></script>
  
  <!-- PDF Generation Scripts -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  
  <script>
  // Add chart initialization logic for superAdmin
  document.addEventListener("DOMContentLoaded", function () {
    const growthLabels = <%- JSON.stringify(growthLabels || []) %>;
    const growthData = <%- JSON.stringify(growthData || []) %>;
    
    const domainLabels = <%- JSON.stringify(domainLabels || []) %>;
    const domainData = <%- JSON.stringify(domainData || []) %>;
    
    const certPctValue = <%= certPct || 0 %>;
    
    const topAmbassadorLabels = <%- JSON.stringify(topAmbassadorLabels || []) %>;
    const topAmbassadorData = <%- JSON.stringify(topAmbassadorData || []) %>;

    // Common Donut Options
    const commonDonutOptions = {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
            legend: {
                position: 'right',
                labels: {
                    color: '#9ca3af',
                    font: { family: 'Inter', size: 11 },
                    boxWidth: 12,
                    padding: 15
                }
            },
            tooltip: {
                backgroundColor: '#1a1a2e',
                titleFont: { size: 13, family: 'Inter' },
                bodyFont: { size: 14, family: 'Inter', weight: 'bold' },
                padding: 12,
                cornerRadius: 8,
            }
        },
        cutout: '70%',
        layout: { padding: 10 }
    };
    
    const colorPalette = ['#ff6600', '#F59E0B', '#10B981', '#3B82F6', '#8B5CF6', '#EC4899', '#f43f5e'];

    // 1. Bar Chart: Intern Growth
    if (document.getElementById('internGrowthChart')) {
      const gCtx = document.getElementById('internGrowthChart').getContext('2d');

      new Chart(gCtx, {
        type: 'bar', // Changed from line to bar
        data: {
          labels: growthLabels.length ? growthLabels : ["No Data"],
          datasets: [{
            label: 'Interns per Batch',
            data: growthData.length ? growthData : [0],
            backgroundColor: 'rgba(255, 102, 0, 0.8)',
            borderColor: '#ff6600',
            borderWidth: 1,
            borderRadius: 4,
            hoverBackgroundColor: '#ff6600'
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: { display: false },
            tooltip: {
              backgroundColor: '#1a1a2e',
              titleFont: { size: 13, family: 'Inter' },
              bodyFont: { size: 14, family: 'Inter', weight: 'bold' },
              padding: 12,
              cornerRadius: 8,
              displayColors: false
            }
          },
          scales: {
            x: {
              grid: { display: false, drawBorder: false },
              ticks: { font: { family: 'Inter', size: 11 }, color: '#9ca3af' }
            },
            y: {
              grid: { color: 'rgba(0,0,0,0.04)', drawBorder: false },
              ticks: { font: { family: 'Inter', size: 11 }, color: '#9ca3af', precision: 0 },
              beginAtZero: true
            }
          }
        }
      });
    }

    // 2. Donut Chart: Domain Distribution
    if (document.getElementById('domainDonutChart')) {
        const dCtx = document.getElementById('domainDonutChart').getContext('2d');
        new Chart(dCtx, {
            type: 'doughnut',
            data: {
                labels: domainLabels.length ? domainLabels : ["No Data"],
                datasets: [{
                    data: domainData.length ? domainData : [1],
                    backgroundColor: domainData.length ? colorPalette : ['#e5e7eb'],
                    borderWidth: 0,
                    hoverOffset: 4
                }]
            },
            options: commonDonutOptions
        });
    }

    // 3. Donut Chart: Certified Interns
    if (document.getElementById('certifiedDonutChart')) {
        const cCtx = document.getElementById('certifiedDonutChart').getContext('2d');
        new Chart(cCtx, {
            type: 'doughnut',
            data: {
                labels: ['Certified', 'Pending'],
                datasets: [{
                    data: [certPctValue, 100 - certPctValue],
                    backgroundColor: ['#10B981', '#f3f4f6'],
                    borderWidth: 0,
                    hoverOffset: 4
                }]
            },
             options: {
                ...commonDonutOptions,
                plugins: {
                    ...commonDonutOptions.plugins,
                    legend: { display: false } // Hide legend for clean look
                }
            },
            plugins: [{
                id: 'textCenter',
                beforeDraw: function(chart) {
                    var width = chart.width, height = chart.height, ctx = chart.ctx;
                    ctx.restore();
                    var fontSize = (height / 114).toFixed(2);
                    ctx.font = "bold " + fontSize + "em Inter";
                    ctx.textBaseline = "middle";
                    ctx.fillStyle = "#1f2937";
                    var text = certPctValue + "%",
                        textX = Math.round((width - ctx.measureText(text).width) / 2),
                        textY = height / 2;
                    ctx.fillText(text, textX, textY);
                    
                    ctx.font = "normal " + (fontSize/2.5).toFixed(2) + "em Inter";
                    ctx.fillStyle = "#6b7280";
                    var text2 = "Certified",
                        text2X = Math.round((width - ctx.measureText(text2).width) / 2),
                        text2Y = height / 2 + 25;
                    ctx.fillText(text2, text2X, text2Y);
                    ctx.save();
                }
            }]
        });
    }

    // 4. Bar Chart: Top 5 Ambassadors
    if (document.getElementById('ambassadorBarChart')) {
        const aCtx = document.getElementById('ambassadorBarChart').getContext('2d');
        new Chart(aCtx, {
            type: 'bar',
            data: {
                labels: topAmbassadorLabels.length ? topAmbassadorLabels : ["No Data"],
                datasets: [{
                    label: 'Referred Interns',
                    data: topAmbassadorData.length ? topAmbassadorData : [0],
                    backgroundColor: topAmbassadorData.length ? ['#8B5CF6', '#3B82F6', '#EC4899', '#F59E0B', '#10B981'] : ['#e5e7eb'],
                    borderWidth: 0,
                    borderRadius: 4
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { display: false },
                    tooltip: {
                        backgroundColor: '#1a1a2e',
                        titleFont: { size: 13, family: 'Inter' },
                        bodyFont: { size: 14, family: 'Inter', weight: 'bold' },
                        padding: 12,
                        cornerRadius: 8,
                        displayColors: false
                    }
                },
                scales: {
                    x: {
                        grid: { display: false, drawBorder: false },
                        ticks: { font: { family: 'Inter', size: 11 }, color: '#9ca3af' }
                    },
                    y: {
                        grid: { color: 'rgba(0,0,0,0.04)', drawBorder: false },
                        ticks: { font: { family: 'Inter', size: 11 }, color: '#9ca3af', precision: 0 },
                        beginAtZero: true
                    }
                },
                layout: { padding: 10 }
            }
        });
    }

  });

  // PDF Download Function with Loader
  async function downloadRegistrationPDF(regId, regName) {
    // Create and show loader
    const loader = document.createElement('div');
    loader.id = 'pdfLoader';
    loader.innerHTML = `
      <div style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 9999; display: flex; align-items: center; justify-content: center;">
        <div style="background: white; padding: 2rem 3rem; border-radius: 15px; text-align: center; box-shadow: 0 10px 40px rgba(0,0,0,0.3);">
          <div class="spinner-border text-primary mb-3" role="status" style="width: 3rem; height: 3rem;">
            <span class="visually-hidden">Loading...</span>
          </div>
          <h5 class="mb-2">Generating PDF...</h5>
          <p class="text-muted mb-0">Please wait while we prepare your document</p>
        </div>
      </div>
    `;
    document.body.appendChild(loader);

    try {
      const element = document.getElementById('pdfTemplate' + regId);
      
      if (!element) {
        throw new Error('PDF template not found');
      }

      element.style.display = 'block';
      element.style.position = 'absolute';
      element.style.left = '-9999px';
      element.style.top = '0';
      
      await new Promise(resolve => setTimeout(resolve, 100));
      
      const canvas = await html2canvas(element, {
        scale: 2,
        useCORS: true,
        allowTaint: true,
        logging: false,
        backgroundColor: '#ffffff',
        windowWidth: 1200,
        windowHeight: element.scrollHeight
      });
      
      element.style.display = 'none';
      element.style.position = '';
      element.style.left = '';
      element.style.top = '';
      
      const { jsPDF } = window.jspdf;
      const pdf = new jsPDF('p', 'mm', 'a4');
      const imgData = canvas.toDataURL('image/png');
      const imgWidth = 210; 
      const pageHeight = 297; 
      const imgHeight = (canvas.height * imgWidth) / canvas.width;
      let heightLeft = imgHeight;
      let position = 0;

      pdf.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);
      heightLeft -= pageHeight;

      while (heightLeft > 0) {
        position = heightLeft - imgHeight;
        pdf.addPage();
        pdf.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);
        heightLeft -= pageHeight;
      }
      
      const fileName = 'Registration_' + regName.replace(/\s+/g, '_') + '.pdf';
      pdf.save(fileName);
      
      document.body.removeChild(loader);
      
      if (typeof showToast === 'function') {
        showToast('PDF downloaded successfully!', 'success');
      }
    } catch (error) {
      console.error('PDF generation error:', error);
      
      if (document.body.contains(loader)) {
        document.body.removeChild(loader);
      }
      
      if (typeof showToast === 'function') {
        showToast('Error generating PDF: ' + error.message, 'error');
      } else {
        alert('Error generating PDF. Please try again.');
      }
    }
  }
  </script>
  <!-- Global Modals Stacking Fix -->
  <% ambassadors.forEach(ambassador => { %>
      <!-- Update Ambassador Modal -->
      <div class="modal fade mt-0" id="updateAmbassadorModal<%= ambassador._id %>" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Update <%= ambassador.name %></h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <form action="/update-ambassador/<%= ambassador._id %>" method="POST" class="needs-validation" novalidate>
        <div class="modal-body">
          <div class="row g-3">

            <!-- Row 1 -->
            <div class="col-md-6">
              <label class="form-label">Name <span class="text-danger">*</span></label>
              <input type="text" name="name" class="form-control" value="<%= ambassador.name %>" placeholder="Full Name" required>
            </div>
            <div class="col-md-6">
              <label class="form-label">Email <span class="text-danger">*</span></label>
              <input type="email" name="email" class="form-control" value="<%= ambassador.email %>" placeholder="Email Address" required>
            </div>

            <!-- Row 2 -->
            <div class="col-md-6">
              <label class="form-label">Password</label>
              <input type="text" name="password" class="form-control" placeholder="Enter new password (leave blank if unchanged)">
            </div>
            <div class="col-md-6">
              <label class="form-label">Ambassador ID <span class="text-danger">*</span></label>
              <input type="text" name="ambassador_id" class="form-control" value="<%= ambassador.ambassador_id %>" placeholder="Unique ID" required>
            </div> 

            <!-- Row 3 -->
            <div class="col-md-6">
              <label class="form-label">Designation</label>
              <input type="text" name="designation" class="form-control" value="<%= ambassador.designation %>" placeholder="Designation">
            </div>
            <div class="col-md-6">
              <label class="form-label">Phone <span class="text-danger">*</span></label>
              <input type="text" name="phone" class="form-control" value="<%= ambassador.phone %>" placeholder="Phone Number" required>
            </div>
            <!-- Row 4 -->
            <div class="col-md-6">
              <label class="form-label">Reffral Code</label>
              <input type="text" name="reffralID" class="form-control" value="<%= ambassador.referralId %>" readonly>
            </div>

            
            <div class="col-md-6">
  <label class="form-label">Mail Sent</label>
  <select name="mail_sent" class="form-select">
    <option value="">Select Mail Type</option>
     <option value="reset">Reset</option>
    <option value="bronze">Bronze</option>
    <option value="silver">Silver</option>
    <option value="gold">Gold</option>
  </select>
</div>

            <!-- Row 5 -->
            <div class="col-md-6">
              <label class="form-label">Offer Letter Link</label>
              <input type="text" name="offer_letter_link" class="form-control" value="<%= ambassador.offer_letter_link %>" >
            </div>
            <div class="col-md-6">
              <label class="form-label">Certificate Link</label>
              <input type="text" name="certificate_link" class="form-control" value="<%= ambassador.certificate_link %>" >
            </div>

          </div>
        </div>

        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
          <button type="submit" class="btn btn-primary">Update</button>
        </div>
      </form>
    </div>
  </div>
</div>


      <!-- Delete Ambassador Modal -->
      <div class="modal fade" id="deleteAmbassadorModal<%= ambassador._id %>" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title">Delete <%= ambassador.name %>?</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">Are you sure you want to delete this ambassador?</div>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
              <form action="/delete-ambassador/<%= ambassador._id %>" method="POST">
                <button class="btn btn-danger">Delete</button>
              </form>
            </div>
          </div>
        </div>
      </div>

    <% }) %>

  <% admins.forEach(admin => { %>
      <!-- Update Admin Modal -->
      <div class="modal fade mt-0" id="updateAdminModal<%= admin._id %>" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title">Update <%= admin.name %></h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <form action="/update-user/<%= admin._id %>" method="POST" enctype="multipart/form-data" >
              <div class="modal-body">
                <label class="form-label">Name</label>
                <input type="text" name="name" class="form-control mb-2" value="<%= admin.name %>" required>
                <label class="form-label">Email</label>
                <input type="email" name="email" class="form-control mb-2" value="<%= admin.email %>" required>
                <label class="form-label">Password</label>
                <input type="text" name="password" class="form-control mb-2"  placeholder="Enter new password (leave blank if unchanged)">
                <label class="form-label">Emp Id</label>
                <input type="text" name="emp_id" class="form-control mb-2" value="<%= admin.emp_id %>" required>
                <label class="form-label">Domain</label>
                <input type="text" name="domain" class="form-control mb-2" value="<%= admin.domain %>" required>
                <label class="form-label">Phone</label>
                <input type="text" name="phone" class="form-control mb-2" value="<%= admin.phone %>" required>
                <label class="form-label">Designation</label>
                <input type="text" name="designation" class="form-control mb-2" value="<%= admin.designation %>" required>
              </div>
              <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="submit" class="btn btn-primary">Update</button>
              </div>
            </form>
          </div>
        </div>
      </div>

      <!-- Delete Admin Modal -->
      <div class="modal fade" id="deleteAdminModal<%= admin._id %>" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title">Delete <%= admin.name %>?</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">Are you sure you want to delete this admin?</div>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
              <form action="/delete-user/<%= admin._id %>" method="POST">
                <button class="btn btn-danger">Delete</button>
              </form>
            </div>
          </div>
        </div>
      </div>
    <% }) %>

  <!-- Intern Modals loop -->
  <% interns.forEach(i => { %>
    <div class="modal fade" id="updateModal<%= i._id %>" tabindex="-1" aria-labelledby="updateModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-lg">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="updateModalLabel">Update Intern Details</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <div class="row align-items-center mb-3">
              <div class="col-12 d-flex align-items-center">
                <label class="form-label mb-0 me-3" style="width: 180px;">Is Passed?</label>
                <select id="isPassed-<%= i._id %>" class="form-select">
                  <option value="true" <%= i.isPassed ? 'selected' : '' %>>Pass</option>
                  <option value="false" <%= !i.isPassed ? 'selected' : '' %>>Fail</option>
                </select>
              </div>
            </div>
            <div class="row align-items-center mb-3">
              <div class="col-12 d-flex align-items-center">
                <label class="form-label mb-0 me-3" style="width: 180px;">Quiz Score</label>
                <input type="number" id="quizScore-<%= i._id %>" class="form-control" value="<%= i.quiz_score || 0 %>" min="0">
              </div>
            </div>
            <div class="row align-items-center mb-3">
              <div class="col-12 d-flex align-items-center">
                <label class="form-label mb-0 me-3" style="width: 180px;">Attempt Count</label>
                <input type="number" id="attemptCount-<%= i._id %>" class="form-control" value="<%= i.attemptCount || 0 %>" min="0">
              </div>
            </div>
            <div class="row align-items-center mb-3">
              <div class="col-12 d-flex align-items-center">
                <label class="form-label mb-0 me-3" style="width: 180px;">Quiz Score</label>
                <input type="number" id="assignmentScore-<%= i._id %>" class="form-control" value="<%= i.quizAssignments?.[0]?.score || 0 %>" min="0">
              </div>
            </div>
            <div class="row align-items-center mb-3">
              <div class="col-12 d-flex align-items-center">
                <label class="form-label mb-0 me-3" style="width: 180px;">Certificate ID</label>
                <input type="text" id="certificateId-<%= i._id %>" class="form-control" value="<%= i.certificate_id %>">
              </div>
            </div>
            <div class="row align-items-center mb-3">
              <div class="col-12 d-flex align-items-center">
                <label class="form-label mb-0 me-3" style="width: 180px;">Certificate Link</label>
                <input type="text" id="certificateLink-<%= i._id %>" class="form-control" value="<%= i.certificate_link %>">
              </div>
            </div>
            <div class="row align-items-center mb-3">
              <div class="col-12 d-flex align-items-center">
                <label class="form-label mb-0 me-3" style="width: 180px;">Starting Date</label>
                <input type="date" id="startingDate-<%= i._id %>" class="form-control" value="<%= i.starting_date ? new Date(i.starting_date).toISOString().split('T')[0] : '' %>">
              </div>
            </div>
            <div class="row align-items-center mb-3">
              <div class="col-12 d-flex align-items-center">
                <label class="form-label mb-0 me-3" style="width: 180px;">Completion Date</label>
                <input type="date" id="completionDate-<%= i._id %>" class="form-control" value="<%= i.completion_date ? new Date(i.completion_date).toISOString().split('T')[0] : '' %>">
              </div>
            </div>
          </div>
          <div class="modal-footer">
            <button class="btn btn-success" onclick="updateIntern('<%= i._id %>')">Save Changes</button>
          </div>
        </div>
      </div>
    </div>
  <% }) %>

  <!-- Registration Modals loop -->
  <% registrations.forEach(reg => { %>
    <div class="modal fade" id="viewRegModal<%= reg._id %>" tabindex="-1" aria-hidden="true">
      <div class="modal-dialog modal-xl modal-dialog-centered modal-dialog-scrollable">
        <div class="modal-content border-0 shadow-lg rounded-4 overflow-hidden">
          <div class="modal-header border-0 text-white position-relative" style="background: linear-gradient(135deg, #1f2937, #0f172a); padding:32px 36px;">
            <button type="button" class="btn-close btn-close-white position-absolute" style="top:18px; right:20px;" data-bs-dismiss="modal"></button>
            <div class="d-flex align-items-center gap-3">
              <img src="<%= reg.profile_image_url %>" class="rounded-circle border border-3 border-white shadow" style="width:80px;height:80px;object-fit:cover;">
              <div>
                <h4 class="mb-1 fw-semibold"><%= reg.name %></h4>
                <small class="opacity-75 d-block mt-1"><%= reg.email %></small>
              </div>
            </div>
          </div>
          <div class="px-4 py-3 border-bottom bg-light d-flex justify-content-between align-items-center flex-wrap gap-2">
            <div class="d-flex flex-wrap gap-2">
              <span class="badge rounded-pill px-3 py-2 bg-<%= reg.payment_status === 'SUCCESS' ? 'success' : reg.payment_status === 'FAILED' ? 'danger' : 'warning' %>">
                <i class="bi bi-credit-card me-1"></i><%= reg.payment_status %>
              </span>
              <span class="badge rounded-pill px-3 py-2 bg-info"><i class="bi bi-briefcase me-1"></i><%= reg.domain %></span>
              <span class="badge rounded-pill px-3 py-2 bg-<%= reg.status === 'approved' ? 'success' : reg.status === 'rejected' ? 'danger' : 'warning' %>">
                <i class="bi bi-check-circle me-1"></i><%= reg.status %>
              </span>
            </div>
            <small class="text-muted"><i class="bi bi-calendar me-1"></i>Registered: <%= new Date(reg.createdAt).toLocaleDateString('en-GB') %></small>
          </div>
          <div class="modal-body bg-white p-4">
            <div class="row g-4">
              <div class="col-md-6">
                <div class="card border-0 shadow-sm rounded-3 h-100">
                  <div class="card-header bg-white border-bottom fw-semibold text-primary"><i class="bi bi-person-fill me-2"></i>Personal Information</div>
                  <div class="card-body small">
                    <p class="mb-2"><span class="text-muted">Phone:</span> <strong><%= reg.phone %></strong></p>
                    <p class="mb-2"><span class="text-muted">Course:</span> <strong><%= reg.course %></strong></p>
                    <p class="mb-2"><span class="text-muted">Branch:</span> <strong><%= reg.branch %></strong></p>
                    <p class="mb-0"><span class="text-muted">Year/Sem:</span> <strong><%= reg.year_sem %></strong></p>
                  </div>
                </div>
              </div>
              <div class="col-md-6">
                <div class="card border-0 shadow-sm rounded-3 h-100">
                  <div class="card-header bg-white border-bottom fw-semibold text-primary"><i class="bi bi-mortarboard-fill me-2"></i>Education</div>
                  <div class="card-body small">
                    <p class="mb-2"><span class="text-muted">College:</span> <strong><%= reg.college %></strong></p>
                    <p class="mb-0"><span class="text-muted">University:</span> <strong><%= reg.university %></strong></p>
                  </div>
                </div>
              </div>
              <div class="col-md-6">
                <div class="card border-0 shadow-sm rounded-3 h-100">
                  <div class="card-header bg-white border-bottom fw-semibold text-primary"><i class="bi bi-briefcase-fill me-2"></i>Internship Details</div>
                  <div class="card-body small">
                    <p class="mb-2"><span class="text-muted">Domain:</span> <strong><%= reg.domain %></strong></p>
                    <p class="mb-2"><span class="text-muted">Duration:</span> <strong><%= reg.duration %> Weeks</strong></p>
                    <p class="mb-2"><span class="text-muted">Referral Code:</span> <strong><%= reg.referral_code || 'N/A' %></strong></p>
                    <p class="mb-0"><span class="text-muted">Transaction ID:</span> <strong><%= reg.payID || 'N/A' %></strong></p>
                  </div>
                </div>
              </div>
              <div class="col-md-6">
                <div class="card border-0 shadow-sm rounded-3 h-100">
                  <div class="card-header bg-white border-bottom fw-semibold text-primary"><i class="bi bi-credit-card-fill me-2"></i>Payment Details</div>
                  <div class="card-body small">
                    <p class="mb-2"><span class="text-muted">Order ID:</span> <strong><%= reg.order_id || 'N/A' %></strong></p>
                    <p class="mb-0"><span class="text-muted">Payment Status:</span> <span class="badge bg-<%= reg.payment_status === 'SUCCESS' ? 'success' : reg.payment_status === 'FAILED' ? 'danger' : 'warning' %>"><%= reg.payment_status %></span></p>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="modal-footer border-0 bg-light">
            <button class="btn px-4" style="background-color: #ff6600;" onclick="downloadRegistrationPDF('<%= reg._id %>', '<%= reg.name %>')">
              <i class="bi bi-download me-1"></i>Download PDF
            </button>
          </div>
        </div>
      </div>
    </div>
  <% }) %>

  <!-- Meeting Modals loop -->
  <% meetings.forEach(meeting => { %>
    <div class="modal fade" id="deleteMeetingModal<%= meeting._id %>" tabindex="-1" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Delete <%= meeting.title %>?</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
          </div>
          <div class="modal-body">
            Are you sure you want to delete this meeting for all interns in <%= meeting.domain %> - Batch <%= meeting.batch_no %>?
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
            <form action="/delete-meeting/<%= meeting._id %>" method="POST">
              <input type="hidden" name="domain" value="<%= meeting.domain %>">
              <input type="hidden" name="batch_no" value="<%= meeting.batch_no %>">
              <button class="btn btn-danger">Delete</button>
            </form>
          </div>
        </div>
      </div>
    </div>
  <% }) %>

</body>
</html>
