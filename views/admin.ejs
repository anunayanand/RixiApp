<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Admin Dashboard</title>
  <link rel="stylesheet" href="/bootstrap/css/bootstrap.min.css">
  <link rel="stylesheet" href="/css/style.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/css/admin.css">
  <!-- Favicons -->
  <link href="/img/Rixi Lab New Logo PNG.png" rel="icon">
  <link href="/img/apple-touch-icon.png" rel="apple-touch-icon">  
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script> 

</head>
<body>
<div class="d-flex flex-grow-1">
<%- include("partials/toaster") %>
 <%- include('partials/loader') %>
  <!-- Sidebar -->
<div class="sidebar position-fixed w-20 d-flex flex-column justify-content-between" style="height: 100vh;">
  <div>
    <h2 class="text-center" style="font-weight: bold; margin-bottom: 0px;">
      <img src="/img/Rixi Lab New Logo PNG.png" width="35px" alt="Logo"> Rixi Lab
    </h2>
    <p style="font-size: 11px;text-align: center; font-style: italic;">Rethink Innovate eXecute Inspire</p>
<h4 class="text-center" style="font-size:large; color: #ff6600; margin-bottom: 0px;">Admin Panel</h4>
    <br/>
    <a href="#dashboard"><i class="bi bi-person-lines-fill"></i> Dashboard</a>
    <a href="#viewInterns"><i class="bi bi-people"></i> View Interns</a>
    <!-- <a href="#approvedRegistrations"><i class="bi bi-clipboard-check"></i> Registrations</a> -->
    <a href="#createUser"><i class="bi bi-person-plus"></i> Create Intern</a>
    <a href="#uploadProject"><i class="bi bi-upload"></i> Upload Project</a>
    <a href="#viewProjects"><i class="bi bi-folder2-open"></i> View Projects</a>
    <a href="#submittedProjects"><i class="bi bi-folder-check"></i> Review Project</a>
    <a href="#internAttendance"><i class="bi bi-person-check"></i> Attendance</a>
    <a href="#createQuiz"><i class="bi bi-patch-question"></i> Create Quiz</a>
    <a href="#manageQuizzes"><i class="bi bi-question-square"></i>Manage Quiz</a>
     <a href="#dashboard" data-bs-toggle="modal" data-bs-target="#logoutModal"><i class="bi bi-box-arrow-right"></i> Logout</a>
  </div>

  <!-- Footer at the bottom -->
  <div class="text-center mb-2 mx-3" style="font-size: 0.85rem; color: #888;">
    Â© Copyright 2025-26 Rixi Lab<br/> All Rights Reserved <br/><span style="font-size: smaller;">Developed by Anunay Anand (Director)</span>  
  </div>
</div>


  <!-- Main Content -->
  <div class="main-content flex-grow-1" >

    <!--Header Section -->
    <!-- ðŸ”¹ Header + Notification Bell Container -->
<div class="d-flex justify-content-between align-items-center mb-3 px-3">
   
  <!-- ðŸ·ï¸ Left Side: Header -->
  <div class="header">
    <h4 class="section-title mb-0">
      Welcome to Rixi Lab, <%= admin.name %> - <%= admin.designation %>
    </h4>
  </div>

  <!-- Right Side: Registration Button and Notification Bell -->
  <div class="d-flex gap-2">
    <!-- ðŸ“‹ Registration Button -->
    <button
      class="btn btn-light position-relative"
      onclick="showSection('approvedRegistrations')"
      title="View Registrations"
     style="border: 1px solid #000;"
      >
      <i class="bi bi-clipboard-check fs-4"></i>

      <% const regCount = registrations ? registrations.length : 0; %>
      <% if (regCount > 0) { %>
        <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger" id="regBadge">
          <span id="regCount"><%= regCount %></span>
          <span class="visually-hidden">New registrations</span>
        </span>
      <% } %>
    </button>

    <!-- ðŸ”” Notification Bell -->
    <div class="dropdown position-relative">
      <button
        class="btn btn-light position-relative"
        id="notificationButton"
        data-bs-toggle="dropdown"
        aria-expanded="false"
        title="Notifications"
        style="border: 1px solid #000;"
        >
        <i class="bi bi-bell fs-4"></i>

        <% const unreadCount = notifications ? notifications.length : 0; %>
        <% if (unreadCount > 0) { %>
          <!--  Yellow Dot -->
          <span
            id="notificationDot"
            class="position-absolute top-0 start-100 translate-middle p-1 bg-warning border border-light rounded-circle">
            <span class="visually-hidden">New alerts</span>
          </span>
        <% } %>
      </button>

      <!-- ðŸ”½ Dropdown Menu -->
      <ul
        class="dropdown-menu dropdown-menu-end shadow p-2"
        style="width: 320px; max-height: 400px; overflow-y: auto;"
        id="notificationList">

        <li class="dropdown-header fw-bold d-flex justify-content-between align-items-center">
          <span>Notifications</span>
          <% if (notifications && notifications.length > 0) { %>
            <button type="button" id="markAllBtn" class="btn btn-sm btn-danger">Mark All</button>
          <% } %>
        </li>
        <hr class="my-1">

        <% if (notifications && notifications.length > 0) { %>
          <% notifications.forEach(n => { %>
            <li class="p-2 border-bottom d-flex justify-content-between align-items-start" data-id="<%= n._id %>">
              <div style="white-space: normal;">
                <small><strong><%= n.title %></strong></small><br>
                <small><%= n.message %></small><br>
                <small class="text-muted"><%= new Date(n.createdAt).toLocaleString() %></small>
              </div>
              <button type="button" class="btn btn-sm btn-outline-success mark-as-read" title="Mark as Read">âœ”</button>
            </li>
          <% }) %>
        <% } else { %>
          <li class="p-3 text-center text-muted">No new notifications ðŸŽ‰</li>
        <% } %>
      </ul>
    </div>
  </div>

 

</div>

<!-- Divider -->
<hr class="mt-2">


     
    <!-- Dashboard Section -->

 <!-- Admin Dashboard Section -->
<section id="dashboard">

  <!-- Stats Row -->
   <!-- Header -->
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h4 class="fw-bold mb-0">Admin Dashboard</h4>
    <div class="d-flex align-items-center gap-3">
    </div>
  </div>

  <div class="row g-4 mb-4">
    <div class="col-md-3">
      <div class="card stat-card text-center p-3">
        <h6 class="text-muted">Total Interns</h6>
        <p class="display-5 fw-bold text-primary mb-0"><%= interns.length %></p>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card stat-card text-center p-3">
        <h6 class="text-muted">Total Projects</h6>
        <p class="display-5 fw-bold text-success mb-0"><%= projects.length %></p>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card stat-card text-center p-3">
        <h6 class="text-muted">Total Batches</h6>
        <p class="display-5 fw-bold text-info mb-0"><%= batches.length %></p>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card stat-card text-center p-3">
        <h6 class="text-muted">Certified Interns</h6>
        <p class="display-5 fw-bold text-warning mb-0"><%= certifiedInternsCount %></p>
      </div>
    </div>
  </div>


  <!-- Profile + Message Section -->
  <div class="row g-4">
  <!-- Left Column: Profile + Meetings -->
  <div class="col-md-6 d-flex flex-column gap-3">
    <!-- Profile Card -->
    <div class="card shadow-sm p-3 h-100 profile-card fixed-profile" style="border-left:6px solid #ff6600;">
      <div class="d-flex align-items-center mb-3">
        <img src="<%= admin.img_url %>" alt="Admin Image" class="rounded-circle me-3" width="80" height="80" style="object-fit:cover; cursor: pointer;" data-bs-toggle="modal" data-bs-target="#updateProfileModal">
        <div>
          <h4 class="mb-2"><%= admin.name %></h4>
          <span class="badge bg-success"><%= admin.designation %></span>
        </div>
      </div>
      <div class="row">
        <div class="col-6"><p><strong>Email:</strong> <%= admin.email %></p></div>
        <div class="col-6"><p><strong>Phone:</strong> <%= admin.phone %></p></div>
        <div class="col-6"><p><strong>Domain:</strong> <%= admin.domain %></p></div>
        <div class="col-6"><p><strong>Employee ID:</strong> <%= admin.emp_id %></p></div>
        <div class="col-6">
          <p><strong>Joining Date:</strong> 
            <%= new Date(admin.joining_date)
                .toLocaleDateString("en-GB", { day:"2-digit", month:"2-digit", year:"2-digit" })
                .replace(/\//g, "-") %>
          </p>
        </div>
      </div>
    </div>

    <!-- Meetings Card -->
    <div class="card shadow-sm p-3 h-100 profile-card fixed-profile" style="border-left:6px solid #ff6600;">
      <h5 class="mb-3">Recent Meetings</h5>
      <% 
        const adminMeetings = (admin.meetings || [])
          .filter(meeting => meeting.status === 'upcoming')
          .sort((a, b) => new Date(b.scheduledTime) - new Date(a.scheduledTime));
      %>

      <% if (adminMeetings.length === 0) { %>
        <p class="text-muted">No meetings available</p>
      <% } else { %>
        <div class="meetings-container" style="max-height: 300px; overflow-y: auto;">
          <% adminMeetings.forEach(meeting => { %>
            <div class="mb-2 p-2 border rounded shadow-sm d-flex justify-content-between align-items-center">
              <div style="flex: 1; min-width: 0;">
                <strong style="display: block; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">
                  <%= meeting.title %>
                </strong>
                <div class="text-muted" style="font-size: 0.9rem; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">
                  Week <%= meeting.week %> â€¢ <%= new Date(meeting.scheduledTime).toLocaleString() %>
                </div>
              </div>
              <a href="<%= meeting.link %>" target="_blank" class="btn btn-sm btn-outline-primary ms-3 flex-shrink-0">
                Join
              </a>
            </div>
          <% }) %>
        </div>
      <% } %>
    </div>
  </div>

  <!-- Right Column: Notices -->
  <div class="col-md-6">
    <div class="card shadow-sm p-3 h-100 profile-card scrollable-notice">
      <h5 class="mb-3">ðŸ“¢ Notices from Rajnish Sharma (CEO)</h5>
      <% if (!notices || notices.length === 0) { %>
        <div class="alert alert-secondary p-2">No notices available.</div>
      <% } else { %>
        <% notices.slice().reverse().forEach((notice, index) => { %>
          <div class="alert <%= index === 0 ? 'alert-success' : 'alert-info' %> mb-2 p-2">
            <strong><%= notice.title %></strong><br>
            <small><%= notice.description %></small>
          </div>
        <% }) %>
      <% } %>
    </div>
  </div>
</div>

</section>


 <!-- Inject JSON variables for JS -->




  <!-- Approved Registrations Section -->
  <section id="approvedRegistrations" style="display:none;">
    <div class="container px-0">
      <div class="card shadow-sm border rounded p-3" style="border: 1px solid #ff6600 !important;">
  
        <!-- Section Header -->
        <h4 class="text-center mb-3">Approved Registrations for <%= admin.domain %></h4>
  
        <!-- Registrations Table -->
        <div class="table-responsive" style="max-height: 500px; overflow-y: auto;">
          <table class="table table-striped table-bordered align-middle text-center mb-0">
            <thead class="table-light" style="position: sticky; top: 0; z-index: 2;background-color: #fff">
              <tr>
                <th>Name</th>
                <th>Email</th>
                <th>Duration</th>
                <th>Intern ID</th>
                <th>Batch</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody id="approvedRegistrationsTable">
              <% registrations.forEach(reg => { %>
                <tr>
                  <td><%= reg.name %></td>
                  <td><%= reg.email %></td>
                  <td><%= reg.duration %> Weeks</td>
                  <td>
                    <input type="text" class="form-control form-control-sm intern-id-input" placeholder="Enter Intern ID">
                  </td>
                  <td>
                    <input type="text" class="form-control form-control-sm batch-input" placeholder="Enter Batch">
                  </td>
                  <td>
                    <button class="btn btn-outline-primary btn-sm px-3 rounded-pill" data-bs-toggle="modal" data-bs-target="#viewRegModal<%= reg._id %>">
                      <i class="bi bi-eye"></i> View
                    </button>
                    <button class="btn btn-outline-success btn-sm px-3 rounded-pill" onclick="acceptRegistration('<%= reg._id %>', this)">Accept</button>
                  </td>
                </tr>

                <!-- View Registration Modal -->
                <div class="modal fade" id="viewRegModal<%= reg._id %>" tabindex="-1" aria-hidden="true">
                  <div class="modal-dialog modal-dialog-scrollable modal-xl modal-dialog-centered">
                    <div class="modal-content border-0 shadow-lg rounded-4 overflow-hidden">

                      <!-- HEADER -->
                      <div class="modal-header border-0 text-white position-relative"
                           style="background: linear-gradient(135deg,#667eea,#764ba2); padding:32px 36px;">

                        <!-- Close Button -->
                        <button type="button"
                                class="btn-close btn-close-white position-absolute"
                                style="top:18px; right:20px;"
                                data-bs-dismiss="modal"></button>

                        <div class="d-flex align-items-center gap-3">

                          <img src="<%= reg.profile_image_url %>"
                               class="rounded-circle border border-3 border-white shadow"
                               style="width:80px;height:80px;object-fit:cover;">

                          <div>
                            <h4 class="mb-1 fw-semibold"><%= reg.name %></h4>

                            <div style="font-size:13px; opacity:.95;">
                              <strong>Rixi Lab</strong> â€” Rethink Innovate eXecute Inspire
                            </div>

                            <small class="opacity-75 d-block mt-1"><%= reg.email %></small>
                          </div>

                        </div>
                      </div>

                      <!-- STATUS BAR -->
                      <div class="px-4 py-3 border-bottom bg-light d-flex justify-content-between align-items-center flex-wrap gap-2">

                        <div class="d-flex flex-wrap gap-2">

                          <span class="badge rounded-pill px-3 py-2 bg-<%= reg.payment_status === 'SUCCESS' ? 'success' : reg.payment_status === 'FAILED' ? 'danger' : 'warning' %>">
                            <i class="bi bi-credit-card me-1"></i><%= reg.payment_status %>
                          </span>

                          <span class="badge rounded-pill px-3 py-2 bg-info">
                            <i class="bi bi-briefcase me-1"></i><%= reg.domain %>
                          </span>

                          <span class="badge rounded-pill px-3 py-2 bg-<%= reg.status === 'approved' ? 'success' : reg.status === 'rejected' ? 'danger' : 'warning' %>">
                            <i class="bi bi-check-circle me-1"></i><%= reg.status %>
                          </span>

                        </div>

                        <small class="text-muted">
                          <i class="bi bi-calendar me-1"></i>
                          Registered: <%= new Date(reg.createdAt).toLocaleDateString('en-GB') %>
                        </small>
                      </div>

                      <!-- BODY -->
                      <div class="modal-body bg-white p-4">
                        <div class="row g-4">

                          <!-- PERSONAL -->
                          <div class="col-md-6">
                            <div class="card border-0 shadow-sm rounded-3 h-100">
                              <div class="card-header bg-white border-bottom fw-semibold text-primary">
                                <i class="bi bi-person-fill me-2"></i>Personal Information
                              </div>
                              <div class="card-body small">
                                <p class="mb-2"><span class="text-muted">Phone:</span> <strong><%= reg.phone %></strong></p>
                                <p class="mb-2"><span class="text-muted">Course:</span> <strong><%= reg.course %></strong></p>
                                <p class="mb-2"><span class="text-muted">Branch:</span> <strong><%= reg.branch %></strong></p>
                                <p class="mb-0"><span class="text-muted">Year/Sem:</span> <strong><%= reg.year_sem %></strong></p>
                              </div>
                            </div>
                          </div>

                          <!-- EDUCATION -->
                          <div class="col-md-6">
                            <div class="card border-0 shadow-sm rounded-3 h-100">
                              <div class="card-header bg-white border-bottom fw-semibold text-primary">
                                <i class="bi bi-mortarboard-fill me-2"></i>Education
                              </div>
                              <div class="card-body small">
                                <p class="mb-2"><span class="text-muted">College:</span> <strong><%= reg.college %></strong></p>
                                <p class="mb-0"><span class="text-muted">University:</span> <strong><%= reg.university %></strong></p>
                              </div>
                            </div>
                          </div>

                          <!-- INTERNSHIP -->
                          <div class="col-md-6">
                            <div class="card border-0 shadow-sm rounded-3 h-100">
                              <div class="card-header bg-white border-bottom fw-semibold text-primary">
                                <i class="bi bi-briefcase-fill me-2"></i>Internship Details
                              </div>
                              <div class="card-body small">
                                <p class="mb-2"><span class="text-muted">Domain:</span> <strong><%= reg.domain %></strong></p>
                                <p class="mb-2"><span class="text-muted">Duration:</span> <strong><%= reg.duration %> Weeks</strong></p>
                                <p class="mb-0"><span class="text-muted">Referral Code:</span> <strong><%= reg.referral_code || 'N/A' %></strong></p>
                              </div>
                            </div>
                          </div>

                          <!-- PAYMENT -->
                          <div class="col-md-6">
                            <div class="card border-0 shadow-sm rounded-3 h-100">
                              <div class="card-header bg-white border-bottom fw-semibold text-primary">
                                <i class="bi bi-credit-card-fill me-2"></i>Payment Details
                              </div>
                              <div class="card-body small">
                                <p class="mb-2"><span class="text-muted">Transaction ID:</span> <strong><%= reg.payID || 'N/A' %></strong></p>
                                <p class="mb-0">
                                  <span class="text-muted">Payment Status:</span>
                                  <span class="badge bg-<%= reg.payment_status === 'SUCCESS' ? 'success' : reg.payment_status === 'FAILED' ? 'danger' : 'warning' %>">
                                    <%= reg.payment_status %>
                                  </span>
                                </p>
                              </div>
                            </div>
                          </div>

                        </div>
                      </div>

                      <!-- FOOTER -->
                      <div class="modal-footer border-0 bg-light">
                        <button class="btn btn-primary px-4"
                                onclick="downloadRegistrationPDF('<%= reg._id %>', '<%= reg.name %>')">
                          <i class="bi bi-download me-1"></i>Download PDF
                        </button>
                      </div>

                    </div>
                  </div>
                </div>

                <!-- PDF Template (Hidden) -->
                <div id="pdfTemplate<%= reg._id %>" style="display: none;">
                  <div style="padding: 40px; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;">
                    <!-- Header -->
                    <div style="text-align: center; margin-bottom: 30px; padding-bottom: 20px; border-bottom: 3px solid #667eea;">
                      <img src="/img/Rixi Lab New Logo PNG.png" alt="Rixi Lab" style="width: 60px; height: 60px; margin-bottom: 10px;">
                      <h1 style="color: #667eea; margin: 0; font-size: 28px;">Rixi Lab</h1>
                      <p style="color: #666; margin: 5px 0 0; font-size: 12px;">Rethink Innovate eXecute Inspire</p>
                    </div>
                    
                    <!-- Title -->
                    <h2 style="color: #333; text-align: center; margin-bottom: 30px; font-size: 22px;">Registration Details</h2>
                    
                    <!-- Profile Section -->
                    <div style="text-align: center; margin-bottom: 30px;">
                      <img src="<%= reg.profile_image_url %>" alt="Profile" style="width: 100px; height: 100px; border-radius: 50%; object-fit: cover; border: 3px solid #667eea;">
                      <h3 style="color: #333; margin: 15px 0 5px;"><%= reg.name %></h3>
                      <p style="color: #666; margin: 0;"><%= reg.email %></p>
                      <div style="margin-top: 15px;">
                        <span style="background: #667eea; color: white; padding: 5px 15px; border-radius: 20px; font-size: 12px; margin-left: 5px;"><%= reg.domain %></span>
                        <span style="background: #28a745; color: white; padding: 5px 15px; border-radius: 20px; font-size: 12px; margin-left: 5px;"><%= reg.status %></span>
                      </div>
                    </div>
                    
                    <!-- Info Sections -->
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                      <!-- Personal Info -->
                      <div style="background: #f8f9fa; padding: 20px; border-radius: 10px;">
                        <h4 style="color: #667eea; margin: 0 0 15px; font-size: 16px; border-bottom: 1px solid #ddd; padding-bottom: 10px;">Personal Information</h4>
                        <p style="margin: 8px 0; color: #555;"><strong>Phone:</strong> <%= reg.phone %></p>
                        <p style="margin: 8px 0; color: #555;"><strong>Course:</strong> <%= reg.course %></p>
                        <p style="margin: 8px 0; color: #555;"><strong>Branch:</strong> <%= reg.branch %></p>
                        <p style="margin: 8px 0; color: #555;"><strong>Year/Sem:</strong> <%= reg.year_sem %></p>
                      </div>
                      
                      <!-- Educational Info -->
                      <div style="background: #f8f9fa; padding: 20px; border-radius: 10px;">
                        <h4 style="color: #667eea; margin: 0 0 15px; font-size: 16px; border-bottom: 1px solid #ddd; padding-bottom: 10px;">Educational Information</h4>
                        <p style="margin: 8px 0; color: #555;"><strong>College:</strong> <%= reg.college %></p>
                        <p style="margin: 8px 0; color: #555;"><strong>University:</strong> <%= reg.university %></p>
                      </div>
                      
                      <!-- Internship Details -->
                      <div style="background: #f8f9fa; padding: 20px; border-radius: 10px;">
                        <h4 style="color: #667eea; margin: 0 0 15px; font-size: 16px; border-bottom: 1px solid #ddd; padding-bottom: 10px;">Internship Details</h4>
                        <p style="margin: 8px 0; color: #555;"><strong>Domain:</strong> <%= reg.domain %></p>
                        <p style="margin: 8px 0; color: #555;"><strong>Duration:</strong> <%= reg.duration %> Weeks</p>
                        <p style="margin: 8px 0; color: #555;"><strong>Referral Code:</strong> <%= reg.referral_code || 'N/A' %></p>
                      </div>
                      
                      <!-- Registration Info -->
                      <div style="background: #f8f9fa; padding: 20px; border-radius: 10px;">
                        <h4 style="color: #667eea; margin: 0 0 15px; font-size: 16px; border-bottom: 1px solid #ddd; padding-bottom: 10px;">Registration Info</h4>
                        <p style="margin: 8px 0; color: #555;"><strong>Registered On:</strong> <%= new Date(reg.createdAt).toLocaleDateString('en-GB') %></p>
                        <p style="margin: 8px 0; color: #555;"><strong>Status:</strong> <%= reg.status %></p>
                      </div>
                    </div>
                    
                    <!-- Footer -->
                    <div style="text-align: center; margin-top: 30px; padding-top: 20px; border-top: 1px solid #ddd; color: #999; font-size: 11px;">
                      <p style="margin: 0;">Â© 2025-26 Rixi Lab. All Rights Reserved.</p>
                      <p style="margin: 5px 0 0;">Generated on <%= new Date().toLocaleString() %></p>
                    </div>
                  </div>
                </div>
              <% }) %>
            </tbody>
          </table>
        </div>
  
      </div>
    </div>
  </section>
  
       <!-- Create Intern -->
    <section id="createUser" style="display:none;"> 
   <div class="card p-4 shadow-sm " style="border: 1px solid #ff6600">
      <h4 class="section-title text-center mb-4">Create Intern</h4>
     <form action="/create-user" method="POST" class="row g-3 needs-validation"  novalidate >
       <div class="col-md-6"><input type="text" name="name" class="form-control" placeholder="Full Name" required></div>
       <div class="col-md-6"><input type="email" name="email" class="form-control" placeholder="Email" required></div>

       <div class="col-md-6"><input type="text" name="phone" class="form-control" placeholder="Phone" required></div>
       <div class="col-md-6"><input type="text" name="domain" class="form-control" placeholder="<%= admin.domain %>" value="<%= admin.domain %>" readonly></div>
       
       <div class="col-md-6"><input type="text" name="password" class="form-control" placeholder="Password" required></div>
       <div class="col-md-6"><input type="text" name="intern_id" class="form-control" placeholder="Intern ID" required></div>

       <div class="col-md-6"><input type="text" name="university" class="form-control" placeholder="University" required></div>
       <div class="col-md-6"><input type="text" name="college" class="form-control" placeholder="College" required ></div>

       <div class="col-md-6"><input type="text" name="course" class="form-control" placeholder="Course" required></div>
       <div class="col-md-6"><input type="text" name="branch" class="form-control" placeholder="Branch" required></div>
       
       <!-- Year/Sem Dropdown -->
<div class="col-md-6">
  <select name="year_sem" class="form-select" required>
    <option value="" selected disabled>Select Year/Sem</option>
    <option value="1st Year/1st Sem">1st Year/1st Sem</option>
    <option value="1st Year/2nd Sem">1st Year/2nd Sem</option>
    <option value="2nd Year/3rd Sem">2nd Year/3rd Sem</option>
    <option value="2nd Year/4th Sem">2nd Year/4th Sem</option>
    <option value="3rd Year/5th Sem">3rd Year/5th Sem</option>
    <option value="3rd Year/6th Sem">3rd Year/6th Sem</option>
  </select>
</div>

<!-- Duration Dropdown -->
<div class="col-md-6">
  <select name="duration" class="form-select" required>
    <option value="" selected disabled>Select Duration (Weeks)</option>
    <option value="4">4</option>
    <option value="6">6</option>
    <option value="8">8</option>
  </select>
</div>


       <div class="col-md-6"><input type="text" name="batch_no" class="form-control" placeholder="Batch" required></div>
   
       <div class="col-md-6"><input type="date" name="starting_date" class="form-control" placeholder="Starting Date" required></div>

       <div class="col-md-6"> <input type="text" name="referal_code"  class="form-control" placeholder="Referal Code"></div>
       <div class="col-12 text-center mt-3">
         <button class="btn btn-primary px-5">Create Intern</button>
       </div>
     </form>
   </div>
 </section>


     <!-- Upload Project -->
<section id="uploadProject" style="display:none;">
   <div class="card shadow-sm " style="border:1px solid #ff6600">
     <h4 class="section-title mt-4 mb-0 text-center">Upload Project</h4>
     <div class="card-body p-4">
       <form method="POST" action="/admin/projects" class="row g-4 needs-validation" novalidate>
         
         <!-- Row 1 -->
         <div class="col-md-6">
           <label class="form-label fw-semibold">Project Title</label>
           <input type="text" name="title" class="form-control" placeholder="Enter project title" required>
         </div>
         
         <div class="col-md-6">
           <label class="form-label fw-semibold">Description</label>
           <input type="text" name="description" class="form-control" placeholder="Enter short description" required>
         </div>

         <!-- Row 2 -->
         <div class="col-md-6">
           <label class="form-label fw-semibold">Download Link</label>
           <input type="url" name="downloadLink" class="form-control" placeholder="Paste download link" required>
         </div>
         
         <div class="col-md-6">
           <label class="form-label fw-semibold">Upload Link</label>
           <input type="url" name="uploadLink" class="form-control" placeholder="Paste upload link" required>
         </div>

         <!-- Row 3 -->
         <div class="col-md-6">
           <label class="form-label fw-semibold">Batch</label>
           <select name="batch_no" class="form-select" required>
             <option value="" disabled selected>Select Batch</option>
             <% batches.forEach(b => { %>
               <option value="<%= b %>"><%= b %></option>
             <% }) %>
           </select>
         </div>

         <div class="col-md-6">
           <label class="form-label fw-semibold">Week</label>
           <select name="week" class="form-select" required>
             <option value="" disabled selected>Select Week</option>
             <% for (let i = 1; i <= 8; i++) { %>
               <% if (i !== 5 && i !== 7) { %>
                 <option value="<%= i %>">Week <%= i %></option>
               <% } %>
             <% } %>
           </select>
         </div>

         <!-- Button Row -->
         <div class="col-12 text-center mt-3">
           <button class="btn btn-primary px-5 py-2 ">
             Create Project
           </button>
         </div>

       </form>
     </div>
   </div>
 </section>





 <!-- View Interns Section -->
 <section id="viewInterns" style="display:none;">
   <div class="container px-0">
     <div class="card shadow-sm border rounded p-3" style="border : 1px solid #ff6600 !important;">
       
       <!-- Section Header -->
       <h4 class="text-center mb-4">Interns <%= admin.domain %></h4>

       <!-- Filters Row -->
       <div class="row mb-3 g-2 justify-content-center ">
         <div class="col-md-2">
           <select id="batchFilter" class="form-select" onchange="applyInternFilters()">
             <option value="all" selected>All Batches</option>
             <% batches.forEach(batch => { %>
               <option value="<%= batch %>">Batch <%= batch %></option>
             <% }) %>
           </select>
         </div>
         <div class="col-md-2 flex-grow-1">
           <input type="text" id="internSearch" class="form-control" placeholder="Enter Intern ID" onkeyup="applyInternFilters()">
         </div>
         <div class="col-md-2">
           <button class="btn btn-secondary w-100" onclick="clearInternFilters()">Clear Filters</button>
         </div>
       </div>

       <!-- Intern Table -->
       <div class="table-responsive" style="max-height: 500px; overflow-y: auto;">
         <table class="table table-striped table-bordered align-middle mb-0 text-center">
           <!-- Sticky Table Header -->
           <thead class="table-light" style="position: sticky; top: 0; z-index: 2;">
             <tr class="text-center">
               <th style="width: 60px;">S.No</th>
               <th style="width: 5rem;">Profile</th>
               <th>Name</th>
               <th>Email</th>
               <th>Duration</th>
               <th>Intern ID</th>
               <th>Batch</th>
               <th style="min-width: 7.5rem !important;">Actions</th>
             </tr>
           </thead>
           <tbody>
             <% interns.forEach((i, index) => { %>
               <tr class="intern-row" data-batch="<%= i.batch_no %>">
                 <td class="serial-no" style="padding:0 !important;"><%= index + 1 %></td>
                 <td style="padding:0 !important;">
                   <img src="<%= i.img_url %>" alt="<%= i.name %>" class="rounded-circle" style="width: 40px; height: 40px; object-fit: cover; padding:0 !important;">
                 </td>
                 <td style="text-align: left !important; padding-left: 1rem;"><%= i.name %></td>
                 <td style="text-align: left !important; padding-left: 1rem;"><%= i.email %></td>
                 <td style="padding:0 !important;"><%= i.duration %> Weeks</td>
                 <td class="intern-id"><%= i.intern_id %></td>
                 <td ><%= i.batch_no %></td>
                  <td class="d-flex justify-content-evenly gap-2 ">
                  <a href="/admin/intern/<%= i._id %>" class="btn btn-outline-primary btn-sm px-3 rounded-pill shadow-sm" target="_blank"> <i class="bi bi-eye"></i></a>
                  <button class="btn btn-outline-secondary btn-sm px-3 rounded-pill" data-bs-toggle="modal" data-bs-target="#updateModal<%= i._id %>"><i class="bi bi-pencil-square"></i></button>
                </td>
               </tr>

               <!-- Update Intern Modal -->
               <div class="modal fade" id="updateModal<%= i._id %>" tabindex="-1" aria-hidden="true">
                 <div class="modal-dialog modal-lg">
                   <div class="modal-content">
                     <div class="modal-header">
                       <h5 class="modal-title">Update Intern Details</h5>
                       <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                     </div>
                     <form action="/update-user/<%= i._id %>" method="POST" enctype="multipart/form-data">
                       <div class="modal-body">
                         <div class="row g-3">
                           <div class="col-md-6">
                             <label class="form-label">Name</label>
                             <input type="text" name="name" class="form-control mb-2" value="<%= i.name %>" required>
                           </div>
                           <div class="col-md-6">
                             <label class="form-label">Email</label>
                             <input type="email" name="email" class="form-control mb-2" value="<%= i.email %>" required>
                           </div>
                           <div class="col-md-6">
                             <label class="form-label">Phone</label>
                             <input type="text" name="phone" class="form-control mb-2" value="<%= i.phone %>" required>
                           </div>
                           <div class="col-md-6">
                             <label class="form-label">Intern ID</label>
                             <input type="text" name="intern_id" class="form-control mb-2" value="<%= i.intern_id %>" required>
                           </div>
                           <div class="col-md-6">
                             <label class="form-label">University</label>
                             <input type="text" name="university" class="form-control mb-2" value="<%= i.university %>" required>
                           </div>
                           <div class="col-md-6">
                             <label class="form-label">College</label>
                             <input type="text" name="college" class="form-control mb-2" value="<%= i.college %>" required>
                           </div>
                           <div class="col-md-6">
                             <label class="form-label">Course</label>
                             <input type="text" name="course" class="form-control mb-2" value="<%= i.course %>" required>
                           </div>
                           <div class="col-md-6">
                             <label class="form-label">Branch</label>
                             <input type="text" name="branch" class="form-control mb-2" value="<%= i.branch %>" required>
                           </div>
                           <div class="col-md-6">
                             <label class="form-label">Batch</label>
                             <input type="text" name="batch_no" class="form-control mb-2" value="<%= i.batch_no %>" required>
                           </div>
                           <div class="col-md-6">
                             <label class="form-label">Domain</label>
                             <input type="text" name="domain" class="form-control mb-2" value="<%= i.domain %>" required>
                           </div>
                           <div class="col-md-6">
                             <label class="form-label">Starting Date</label>
                             <input type="date" name="starting_date" class="form-control mb-2" value="<%= i.starting_date ? i.starting_date.toISOString().split('T')[0] : '' %>" required>
                           </div>
                           <div class="col-md-6">
                             <label class="form-label">Completion Date</label>
                             <input type="date" name="completion_date" class="form-control mb-2" value="<%= i.completion_date ? i.completion_date.toISOString().split('T')[0] : '' %>">
                           </div>
                           <div class="col-md-6">
                             <label class="form-label">Intern's img_url</label>
                             <input type="text" name="img_url" class="form-control mb-2" value="<%= i.img_url %>">
                           </div>
                         </div>
                       </div>
                       <div class="modal-footer">
                         <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                         <button type="submit" class="btn btn-primary">Update</button>
                       </div>
                     </form>
                   </div>
                 </div>
               </div>

               <!-- Delete Intern Modal -->
               <div class="modal fade" id="deleteModal<%= i._id %>" tabindex="-1" aria-hidden="true">
                 <div class="modal-dialog">
                   <div class="modal-content">
                     <div class="modal-header">
                       <h5 class="modal-title">Delete <%= i.name %>?</h5>
                       <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                     </div>
                     <div class="modal-body">Are you sure you want to delete this intern?</div>
                     <div class="modal-footer">
                       <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                       <form action="/delete-user/<%= i._id %>" method="POST">
                         <button class="btn btn-danger">Delete</button>
                       </form>
                     </div>
                   </div>
                 </div>
               </div>
             <% }) %>
           </tbody>
         </table>
       </div>

     </div>
   </div>
 </section>


 <!-- View Projects Section -->
 <section id="viewProjects" style="display:none;">
   <div class="card shadow-sm border rounded p-3" style="border: 1px solid #ff6600 !important;">
     <h4 class="text-center mb-4">Projects List</h4>

     <div class="table-responsive" style="max-height: 500px; overflow-y: auto;">
       <table class="table table-striped table-bordered align-middle text-center">
         <thead class="table-light" style="position: sticky; top: 0; z-index: 2;">
           <tr>
             <th>Project Title</th>
             <th>Description</th>
             <th>Download Link</th>
             <th>Upload Link</th>
             <th>Batch</th>
             <th>Week</th>
             <th>Actions</th>
           </tr>
         </thead>
         <tbody>
           <% projects.forEach(project => { %>
             <tr>
               <td><%= project.title %></td>
               <td><%= project.description %></td>
               <td><a href="<%= project.downloadLink %>" target="_blank" class="btn btn-outline-primary btn-sm"><i class="bi bi-download"></i> Download</a></td>
               <td><a href="<%= project.uploadLink %>" target="_blank" class="btn btn-outline-success btn-sm"><i class="bi bi-upload"></i> Upload</a></td>
               <td><%= project.batch_no %></td>
               <td><%= project.week %></td>
               <td>
                 <button class="btn btn-outline-danger btn-sm" data-bs-toggle="modal" data-bs-target="#deleteProjectModal<%= project._id %>">Delete</button>
               </td>
             </tr>

             <!-- Delete Project Modal -->
             <div class="modal fade" id="deleteProjectModal<%= project._id %>" tabindex="-1" aria-hidden="true">
               <div class="modal-dialog">
                 <div class="modal-content">
                   <div class="modal-header">
                     <h5 class="modal-title">Delete <%= project.title %>?</h5>
                     <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                   </div>
                   <div class="modal-body">Are you sure you want to delete this project?</div>
                   <div class="modal-footer">
                     <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                     <form action="/delete-project/<%= project._id %>" method="POST">
                       <button class="btn btn-danger">Delete</button>
                     </form>
                   </div>
                 </div>
               </div>
             </div>
           <% }) %>
         </tbody>
       </table>
     </div>
   </div>
 </section>

 <!-- Submitted Projects Section -->
 <section id="submittedProjects" style="display:none;">
   <div class="container px-0">
     <div class="card shadow-sm border rounded p-3" style="border: 1px solid #ff6600 !important;">
       <h4 class="text-center mb-4">Review Project Submissions</h4>

       <!-- Filters -->
       <div class="row mb-3 g-2 justify-content-center">
         <div class="col-md-3">
           <select id="submittedBatchFilter" class="form-select" onchange="applySubmittedFilters()">
             <option value="all" selected>All Batches</option>
             <% const submittedBatches = [...new Set(projects.map(p => p.batch_no))]; %>
             <% submittedBatches.forEach(batch => { %>
               <option value="<%= batch %>"><%= batch %></option>
             <% }) %>
           </select>
         </div>
         <div class="col-md-4">
           <input type="text" id="submittedInternSearch" class="form-control" placeholder="Search by Intern ID" onkeyup="applySubmittedFilters()">
         </div>
         <div class="col-md-2">
           <button class="btn btn-secondary w-100" onclick="clearSubmittedFilters()">Clear</button>
         </div>
       </div>

       <div class="row row-cols-1 row-cols-md-3 g-4" id="submittedProjectsContainer">
         <% 
           const currentSubmittedBatch = projects.length > 0 ? projects[0].batch_no : '';
           projects.forEach((project, index) => {
             if (project.status === 'submitted') {
         %>
           <div class="col intern-card" data-batch="<%= project.batch_no %>">
             <div class="card h-100 shadow-sm" style="border-radius: 15px;">
               <div class="card-body">
                 <h5 class="card-title text-primary"><%= project.title %></h5>
                 <p class="card-text text-muted small"><%= project.description %></p>
                 <ul class="list-unstyled small">
                   <li><strong>Intern:</strong> <%= project.userName %></li>
                   <li><strong>Intern ID:</strong> <span class="intern-id"><%= project.intern_id %></span></li>
                   <li><strong>Batch:</strong> <%= project.batch_no %></li>
                   <li><strong>Week:</strong> <%= project.week %></li>
                 </ul>
                 <div class="d-flex gap-2">
                   <a href="<%= project.submittedLink %>" target="_blank" class="btn btn-outline-primary btn-sm flex-grow-1">View Project</a>
                   <form action="/admin/projects/update-status" method="POST" class="flex-grow-1">
                     <input type="hidden" name="userId" value="<%= project.userId %>">
                     <input type="hidden" name="projectId" value="<%= project._id %>">
                     <select name="status" class="form-select form-select-sm" onchange="this.form.submit()">
                       <option value="pending" <%= project.accept_status === 'pending' ? 'selected' : '' %>>Pending</option>
                       <option value="accepted" <%= project.accept_status === 'accepted' ? 'selected' : '' %>>Accept</option>
                       <option value="rejected" <%= project.accept_status === 'rejected' ? 'selected' : '' %>>Reject</option>
                     </select>
                   </form>
                 </div>
               </div>
             </div>
           </div>
         <% } }) %>
       </div>
     </div>
   </div>
 </section>

 <!-- Attendance Section -->
 <section id="internAttendance" style="display:none;">
   <div class="container px-0">
     <div class="card shadow-sm border rounded p-3" style="border: 1px solid #ff6600 !important;">
       <h4 class="text-center mb-4">Intern Attendance</h4>

       <div class="row mb-3 g-2 justify-content-center">
         <div class="col-md-3">
           <select id="attendanceBatchFilter" class="form-select" onchange="applyAttendanceFilters()">
             <option value="all" selected>All Batches</option>
             <% batches.forEach(batch => { %>
               <option value="<%= batch %>"><%= batch %></option>
             <% }) %>
           </select>
         </div>
         <div class="col-md-3">
           <select id="attendanceWeekFilter" class="form-select" onchange="applyAttendanceFilters()">
             <option value="all" selected>All Weeks</option>
             <% for (let i = 1; i <= 8; i++) { %>
               <option value="<%= i %>">Week <%= i %></option>
             <% } %>
           </select>
         </div>
         <div class="col-md-4">
           <input type="text" id="attendanceSearch" class="form-control" placeholder="Search by Intern ID or Name" onkeyup="applyAttendanceFilters()">
         </div>
         <div class="col-md-2">
           <button class="btn btn-secondary w-100" onclick="clearAttendanceFilters()">Clear</button>
         </div>
       </div>

       <form action="/admin/attendance/update-multiple" method="POST" id="bulkAttendanceForm">
         <input type="hidden" name="bulkInterns" id="bulkInternsInput">
         <div class="table-responsive" style="max-height: 500px; overflow-y: auto;">
           <table class="table table-striped table-bordered align-middle text-center" id="attendanceTable">
             <thead class="table-light" style="position: sticky; top: 0; z-index: 2;">
               <tr>
                 <th><input type="checkbox" id="selectAllAttendance" onclick="toggleSelectAll(this)"></th>
                 <th>Intern Name</th>
                 <th>Intern ID</th>
                 <th>Batch</th>
                 <th>Week</th>
                 <th>Status</th>
               </tr>
             </thead>
             <tbody>
               <% const allAttendance = []; %>
               <% interns.forEach(intern => { %>
                 <% const attendanceMap = {}; %>
                 <% (intern.attendance || []).forEach(a => { attendanceMap[a.week] = a.status; }); %>
                 <% for (let week = 1; week <= 8; week++) { %>
                   <% const status = attendanceMap[week] || 'Absent'; %>
                   <% const statusClass = status === 'Present' ? 'success' : status === 'Absent' ? 'danger' : 'warning'; %>
                   <% allAttendance.push({ intern, week, status }); %>
                   <tr class="attendance-row" data-batch="<%= intern.batch_no %>" data-week="<%= week %>" data-intern="<%= intern.intern_id %>">
                     <td><input type="checkbox" class="row-checkbox" data-user="<%= intern._id %>" data-meeting="<%= week %>"></td>
                     <td><%= intern.name %></td>
                     <td><%= intern.intern_id %></td>
                     <td><%= intern.batch_no %></td>
                     <td>Week <%= week %></td>
                     <td><span class="badge bg-<%= statusClass %>"><%= status %></span></td>
                   </tr>
                 <% } %>
               <% }) %>
             </tbody>
           </table>
         </div>
         <div class="text-center mt-3">
           <button type="submit" class="btn btn-primary">Update Selected</button>
         </div>
       </form>
     </div>
   </div>
 </section>

 <!-- Create Quiz Section -->
 <section id="createQuiz" style="display:none;">
   <div class="card shadow-sm border rounded p-3" style="border: 1px solid #ff6600 !important;">
     <h4 class="text-center mb-4">Create Quiz</h4>
     <form action="/admin/create-quiz" method="POST" class="needs-validation" novalidate>
       <div class="mb-3">
         <label class="form-label">Quiz Title</label>
         <input type="text" name="title" class="form-control" placeholder="Enter Quiz Title" required>
       </div>
       <div class="mb-3">
         <label class="form-label">Batch</label>
         <select name="batch_no" class="form-select" required>
           <option value="" disabled selected>Select Batch</option>
           <% batches.forEach(batch => { %>
             <option value="<%= batch %>"><%= batch %></option>
           <% }) %>
         </select>
       </div>
       <div class="mb-3">
         <label class="form-label">Week</label>
         <select name="week" class="form-select" required>
           <option value="" disabled selected>Select Week</option>
           <% for (let i = 1; i <= 8; i++) { %>
             <% if (i !== 5 && i !== 7) { %>
               <option value="<%= i %>">Week <%= i %></option>
             <% } %>
           <% } %>
         </select>
       </div>
       <div class="mb-3">
         <label class="form-label">Duration (minutes)</label>
         <input type="number" name="duration" class="form-control" placeholder="Enter Duration" required>
       </div>
       <div class="mb-3">
         <label class="form-label">Total Marks</label>
         <input type="number" name="totalMarks" class="form-control" placeholder="Enter Total Marks" required>
       </div>
       <div class="mb-3">
         <label class="form-label">Passing Marks</label>
         <input type="number" name="passingMarks" class="form-control" placeholder="Enter Passing Marks" required>
       </div>
       <div class="mb-3">
         <label class="form-label">Questions (JSON format)</label>
         <textarea name="questions" class="form-control" rows="5" placeholder='[{"question": "Question 1", "options": ["A", "B", "C", "D"], "correctAnswer": 0}]' required></textarea>
       </div>
       <button type="submit" class="btn btn-primary">Create Quiz</button>
     </form>
   </div>
 </section>

 <!-- Manage Quizzes Section -->
 <section id="manageQuizzes" style="display:none;">
   <div class="card shadow-sm border rounded p-3" style="border: 1px solid #ff6600 !important;">
     <h4 class="text-center mb-4">Manage Quizzes</h4>
     <div class="table-responsive">
       <table class="table table-striped table-bordered align-middle text-center">
         <thead class="table-light" style="position: sticky; top: 0; z-index: 2;">
           <tr>
             <th>Title</th>
             <th>Batch</th>
             <th>Week</th>
             <th>Duration</th>
             <th>Total Marks</th>
             <th>Actions</th>
           </tr>
         </thead>
         <tbody>
           <% quizzes.forEach(quiz => { %>
             <tr>
               <td><%= quiz.title %></td>
               <td><%= quiz.batch_no %></td>
               <td><%= quiz.week %></td>
               <td><%= quiz.duration %> min</td>
               <td><%= quiz.totalMarks %></td>
               <td>
                 <button class="btn btn-outline-danger btn-sm" onclick="deleteQuiz('<%= quiz._id %>')">Delete</button>
               </td>
             </tr>
           <% }) %>
         </tbody>
       </table>
     </div>
   </div>
 </section>

 <script>
   async function deleteQuiz(quizId) {
     if (confirm('Are you sure you want to delete this quiz?')) {
       try {
         const response = await fetch(`/admin/delete-quiz/${quizId}`, { method: 'DELETE' });
         const data = await response.json();
         if (data.success) {
           location.reload();
         } else {
           alert('Error deleting quiz');
         }
       } catch (error) {
         console.error('Error:', error);
       }
     }
   }
 </script>

 <!-- Logout Modal -->
 <div class="modal fade" id="logoutModal" tabindex="-1" aria-hidden="true">
   <div class="modal-dialog">
     <div class="modal-content">
       <div class="modal-header">
         <h5 class="modal-title">Logout</h5>
         <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
       </div>
       <div class="modal-body">Are you sure you want to logout?</div>
       <div class="modal-footer">
         <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
         <form action="/logout" method="GET">
           <button class="btn btn-danger">Logout</button>
         </form>
       </div>
     </div>
   </div>
 </div>

 <!-- Update Profile Modal -->
 <div class="modal fade" id="updateProfileModal" tabindex="-1" aria-hidden="true">
   <div class="modal-dialog">
     <div class="modal-content">
       <div class="modal-header">
         <h5 class="modal-title">Update Profile</h5>
         <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
       </div>
       <form action="/admin/profile" method="POST" enctype="multipart/form-data">
         <div class="modal-body">
           <div class="mb-3">
             <label class="form-label">Name</label>
             <input type="text" name="name" class="form-control" value="<%= admin.name %>" required>
           </div>
           <div class="mb-3">
             <label class="form-label">Phone</label>
             <input type="text" name="phone" class="form-control" value="<%= admin.phone %>" required>
           </div>
           <div class="mb-3">
             <label class="form-label">Profile Image</label>
             <input type="file" name="image" id="imageInput" class="form-control" accept="image/*">
             <img id="previewImage" src="<%= admin.img_url %>" alt="Profile" class="mt-2" style="max-width: 100%; max-height: 200px;">
           </div>
         </div>
         <div class="modal-footer">
           <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
           <button type="submit" class="btn btn-primary">Update</button>
         </div>
       </form>
     </div>
   </div>
 </div>

 <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
 <script src="/js/admin.js"></script>
 
 <!-- PDF Generation Scripts -->
 <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
 <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
 
 <script>
 // PDF Download Function with Loader
 async function downloadRegistrationPDF(regId, regName) {
   // Create and show loader
   const loader = document.createElement('div');
   loader.id = 'pdfLoader';
   loader.innerHTML = `
     <div style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 9999; display: flex; align-items: center; justify-content: center;">
       <div style="background: white; padding: 2rem 3rem; border-radius: 15px; text-align: center; box-shadow: 0 10px 40px rgba(0,0,0,0.3);">
         <div class="spinner-border text-primary mb-3" role="status" style="width: 3rem; height: 3rem;">
           <span class="visually-hidden">Loading...</span>
         </div>
         <h5 class="mb-2">Generating PDF...</h5>
         <p class="text-muted mb-0">Please wait while we prepare your document</p>
       </div>
     </div>
   `;
   document.body.appendChild(loader);

   try {
     const element = document.getElementById('pdfTemplate' + regId);
     
     if (!element) {
       throw new Error('PDF template not found');
     }

     // Make element visible temporarily for html2canvas
     element.style.display = 'block';
     element.style.position = 'absolute';
     element.style.left = '-9999px';
     element.style.top = '0';
     
     // Wait a bit for rendering
     await new Promise(resolve => setTimeout(resolve, 100));
     
     // Create canvas from HTML
     const canvas = await html2canvas(element, {
       scale: 2,
       useCORS: true,
       allowTaint: true,
       logging: false,
       backgroundColor: '#ffffff',
       windowWidth: 1200,
       windowHeight: element.scrollHeight
     });
     
     // Hide element again
     element.style.display = 'none';
     element.style.position = '';
     element.style.left = '';
     element.style.top = '';
     
     // Create PDF
     const { jsPDF } = window.jspdf;
     const pdf = new jsPDF('p', 'mm', 'a4');
     const imgData = canvas.toDataURL('image/png');
     const imgWidth = 210; // A4 width in mm
     const pageHeight = 297; // A4 height in mm
     const imgHeight = (canvas.height * imgWidth) / canvas.width;
     let heightLeft = imgHeight;
     let position = 0;

     // Add first page
     pdf.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);
     heightLeft -= pageHeight;

     // Add additional pages if needed
     while (heightLeft > 0) {
       position = heightLeft - imgHeight;
       pdf.addPage();
       pdf.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);
       heightLeft -= pageHeight;
     }
     
     // Download
     const fileName = 'Registration_' + regName.replace(/\s+/g, '_') + '.pdf';
     pdf.save(fileName);
     
     // Remove loader
     document.body.removeChild(loader);
     
     // Show success message
     if (typeof showToast === 'function') {
       showToast('PDF downloaded successfully!', 'success');
     }
   } catch (error) {
     console.error('PDF generation error:', error);
     
     // Remove loader
     if (document.body.contains(loader)) {
       document.body.removeChild(loader);
     }
     
     // Show error message
     if (typeof showToast === 'function') {
       showToast('Error generating PDF: ' + error.message, 'error');
     } else {
       alert('Error generating PDF. Please try again.');
     }
   }
 }
 </script>
</body>
</html>
